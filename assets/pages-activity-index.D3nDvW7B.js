import{_ as t}from"./BannerView.vue_vue_type_script_setup_true_lang.B55NZ1Jk.js";import{_ as a,a as i}from"./activity-cover.C0dUpgrc.js";import{u as s,_ as e}from"./usePaged.BNwJwJlH.js";import{d as r,H as o,C as n,c as u,w as l,r as p,a as c,b as d,A as m,e as v,t as y,M as f,N as g,O as h,P as x}from"./index-Bly4hIk5.js";import{l as _}from"./activity-banner.C3kWKCRr.js";import{u as b}from"./useLocation.Bhq_HojX.js";import"./wd-card.BfjIy9EC.js";import"./wd-divider.DmdDC7_O.js";import"./PyTitle.Cr1dk33U.js";import"./index.Lf5rPU8V.js";const w=r({__name:"index",setup(r){const w=o(),{update:j,longitude:L,latitude:P}=b();n(()=>{console.log("活动列表：",L.value,P.value)});const A=t=>({id:(null==t?void 0:t.id)||Date.now().toString(),img:null==t?void 0:t.picUrl,title:(null==t?void 0:t.name)||"未命名数根"}),S=t=>{const a=[];t.issueProduct&&(Array.isArray(t.issueProduct)?a.push(...t.issueProduct.map(t=>A(t))):a.push(A(t.issueProduct)));const i=[];var s;t.issueVoucher&&(Array.isArray(t.issueVoucher)?i.push(...t.issueVoucher.map(t=>A(t))):i.push({id:(null==(s=t.issueVoucher)?void 0:s.id)||Date.now().toString(),img:null==s?void 0:s.picUrl,title:(null==s?void 0:s.name)||"未命名权益"}));const e=[];return t.attendedUsers&&t.attendedUsers.forEach(t=>{e.push((t=>({avatar:null==t?void 0:t.avatar}))(t))}),{...t,pythrootList:a,profitList:i,participants:e}};const{list:U}=s(async function(t){const a="number"==typeof P.value?String(P.value):void 0,i="number"==typeof L.value?String(L.value):void 0;a&&i?j(!1):await j(!1);const s=await x.app.getActivityPage({params:{type:1,myLocationLatitude:a,myLocationLongitude:i,...t}}),{code:e,data:r}=s||{};if(0!==e||!r)throw new Error("获取数据失败");let o=r.list||[];return o=o.map(t=>S(t)),{list:o,total:r.total||0}});return(s,r)=>{const o=e,n=v,x=a,b=t,j=p("layout-tabbar-uni");return c(),u(j,null,{default:l(()=>[d(b,{"custom-class":"pb-228rpx bg-#EFF2F5","banner-height":"364rpx","banner-src":m(_)},{default:l(()=>[d(n,{class:"p-30rpx gap-20rpx mt-[-278rpx] flex flex-col bg-transparent"},{default:l(()=>[0===m(U).length?(c(),u(n,{key:0,class:"mt-260rpx"},{default:l(()=>[d(o)]),_:1})):y("",!0),(c(!0),f(g,null,h(m(U),t=>(c(),u(x,{key:t.id,"cover-img-src":t.picUrl||m(i),title:t.name,location:t.address||"","start-time":t.createTime,"end-time":t.endTime,participants:t.participants,"pythroot-list":t.pythrootList,"profit-list":t.profitList,distance:t.distance,"extra-button-text":"马上参与","time-status":t.timeStatus,onJoinNow:a=>{return i=t.id,void w.push({name:"activityDetail",params:{id:String(i)}});var i}},null,8,["cover-img-src","title","location","start-time","end-time","participants","pythroot-list","profit-list","distance","time-status","onJoinNow"]))),128))]),_:1})]),_:1},8,["banner-src"])]),_:1})}}});export{w as default};
