import{d as s,aT as e,aN as a,u as o,aU as r,a6 as t,O as p,c as n,a as l,e as c,n as i,h as m,w as u,j as d,t as f,aV as g,aW as h,s as y,a3 as w,aX as b,aD as k,aY as v,_ as O}from"./index-DbmF-9aG.js";const x=O(s({name:"wd-form",options:{addGlobalClass:!0,virtualHost:!0,styleIsolation:"shared"},props:e,setup(s,{expose:e}){const{show:O}=a("wd-form-toast"),x=s,{children:E,linkChildren:_}=o(r);let j=t({});function C(s){s?j[s]="":Object.keys(j).forEach(s=>{j[s]=""})}return _({props:x,errorMessages:j}),p(()=>x.model,()=>{x.resetOnChange&&C()},{immediate:!0,deep:!0}),e({validate:async function(s){const e=[];let a=!0;const o=[],r=function(){const s=v(x.rules),e=E.map(s=>s.prop);return Object.keys(s).forEach(a=>{e.includes(a)||delete s[a]}),E.forEach(e=>{y(e.prop)&&y(e.rules)&&e.rules.length&&(s[e.prop]?s[e.prop]=[...s[e.prop],...e.rules]:s[e.prop]=e.rules)}),s}(),t=h(s)?s:y(s)?[s]:[],p=t.length>0?t.reduce((s,e)=>(r[e]&&(s[e]=r[e]),s),{}):r;for(const n in p){const s=p[n],r=w(x.model,n);if(s&&s.length>0)for(const t of s){if(t.required&&(!y(r)||""===r)){e.push({prop:n,message:t.message}),a=!1;break}if(t.pattern&&!t.pattern.test(r)){e.push({prop:n,message:t.message}),a=!1;break}const{validator:s,...p}=t;if(s){const l=s(r,p);b(l)?o.push(l.then(s=>{"string"==typeof s?(e.push({prop:n,message:s}),a=!1):"boolean"!=typeof s||s||(e.push({prop:n,message:t.message}),a=!1)}).catch(s=>{const o=y(s)?k(s)?s:s.message||t.message:t.message;e.push({prop:n,message:o}),a=!1})):l||(e.push({prop:n,message:t.message}),a=!1)}}}return await Promise.all(o),function(s){const e=E.map(s=>s.prop).filter(Boolean),a=s.filter(s=>s.message&&e.includes(s.prop));a.length&&(a.sort((s,a)=>e.indexOf(s.prop)-e.indexOf(a.prop)),"toast"===x.errorType?O(a[0].message):"message"===x.errorType&&a.forEach(s=>{j[s.prop]=s.message}))}(e),a&&(t.length?t.forEach(C):C()),{valid:a,errors:e}},reset:function(){C()}}),(s,e)=>{const a=c;return l(),n(a,{class:m(`wd-form ${s.customClass}`),style:i(s.customStyle)},{default:u(()=>[d(s.$slots,"default",{},void 0,!0),"toast"===x.errorType?(l(),n(g,{key:0,selector:"wd-form-toast"})):f("",!0)]),_:3},8,["class","style"])}}}),[["__scopeId","data-v-e513a788"]]);export{x as _};
