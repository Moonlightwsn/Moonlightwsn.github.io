import{a8 as e,a9 as t,aa as a,ab as r,ac as s,ad as o,ae as n,af as c,ag as l,ah as i,ai as u,aj as d,ak as f,al as p,am as m,an as x,ao as h,ap as _,aq as g,ar as v,as as E,at as b,au as y,av as S,aw as w,ax as k,ay as C,az as R,aA as U,aB as T,aC as j,aD as N,aE as O,aF as z,aG as A,aH as P,aI as K,aJ as H,aK as F,aL as D,aM as q,aN as I,aO as W,d as L,H as Q,aP as G,D as M,P as B,Q as J,c as V,w as X,r as $,M as Y,R as Z,a as ee,b as te,e as ae,x as re,I as se,B as oe,S as ne,T as ce,U as le,v as ie,J as ue,z as de,X as fe,aQ as pe,K as me,aR as xe,aS as he,F as _e,_ as ge}from"./index-DSHRyYKW.js";import{_ as ve}from"./GradientText.vue_vue_type_script_setup_true_lang.CZuGddRZ.js";import{_ as Ee}from"./PyTitle.BzWse8en.js";import{u as be}from"./useRouteState.CWpGcnlJ.js";import{u as ye}from"./usePageOptions.B_3vrcgE.js";const Se=(e,t)=>{let a=D;return function(...r){const s=e.bind(this,...r),o=T(t)?t:t(...r);a&&P(a),o>0?a=b(s,o):s()}};var we,ke;(ke=we||(we={}))[ke.USE_REQUEST=1]="USE_REQUEST",ke[ke.USE_WATCHER=2]="USE_WATCHER",ke[ke.USE_FETCHER=3]="USE_FETCHER";const Ce=s("useRequest"),Re=s("useWatcher"),Ue=s("useFetcher"),Te=e=>({[we.USE_REQUEST]:Ce,[we.USE_WATCHER]:Re,[we.USE_FETCHER]:Ue}[e]),je="success",Ne="error",Oe="complete";class ze{constructor(e,t){this.method=e,this.args=t}clone(){return{...this}}static spawn(e,t){return S(ze,e,t)}}class Ae extends ze{constructor(e,t,a){super(e.method,e.args),this.data=t,this.fromCache=a}}class Pe extends ze{constructor(e,t){super(e.method,e.args),this.error=t}}class Ke extends ze{constructor(e,t,a,r,s){super(e.method,e.args),this.status=t,this.data=a,this.fromCache="error"!==t&&r,this.error=s}}const He=(e,t)=>t(),Fe={};function De(a,s,n=[]){const i=Te(a.ht);let u=r(s,i,n);const{fs:p,ht:m,c:x}=a,{loading:h,data:_,error:v}=p,E=m===we.USE_FETCHER,{force:b=t,middleware:w=He}=x,k=o(u),{id:C}=k,R=c(u),{abortLast:U=e}=x,T=!a.m;return a.m=u,(async()=>{let r=H,o=t,c=N(d),k=H,j=H;const A=await O(u);let P=()=>!!A,D=t;E||(((e,t,a)=>{const r=Fe[e]=Fe[e]||{};r[t]||(r[t]=S(Set)),r[t].add(a)})(C,R,a),r=()=>((e,t,a)=>{const r=Fe[e],s=r[t];r&&s&&(a?s.delete(a):s.clear(),0===s.size&&F(r,t))})(C,R,a));const q=s=>{o=e;const{force:l=b,method:i=u}=s||{},d=f(l,[S(ze,u,n)]),m=e=>({loaded:t,total:a})=>{p[e].v={loaded:t,total:a}};u=i,a.rf[R]=r,D||(h.v=!!d||!A);const{downloading:x,uploading:_}=a.ro.trackedKeys;return k=x?u.onDownload(m("downloading")):k,j=_?u.onUpload(m("uploading")):j,c=u.send(d),P=()=>u.fromCache||t,c},I={method:u,cachedResponse:A,config:x,abort:()=>u.abort()},W=()=>m!==we.USE_WATCHER||!U||a.m===u,L=(a=e)=>{a&&T&&(h.v=t),D=a},Q=w(E?{...I,args:n,fetch:(e,...t)=>(((e,t)=>{e(l(t,K),"expected a method instance.")})(i,e),De(a,e,t)),proxyStates:z(p,"data"),controlLoading:L}:{...I,args:n,send:(...e)=>De(a,s,e),proxyStates:p,controlLoading:L},q);let G=d;const M=ze.spawn(u,n);try{const e=await Q,r=e=>(E?a.c.updateState!==t&&g(((e,t)=>{const a=Fe[e]||{};return a[t]?Array.from(a[t]):[]})(C,R),t=>{t.fs.data.v=e}):W()&&(_.v=e),W()&&(v.v=d,!D&&(h.v=t),a.em.emit(je,S(Ae,M,e,P())),a.em.emit(Oe,S(Ke,M,je,e,P(),d))),e);G=e!==d?r(e):o?await y(c,r,()=>r(d)):d,!o&&!D&&(h.v=t)}catch(B){throw W()&&(v.v=B,!D&&(h.v=t),a.em.emit(Ne,S(Pe,M,B)),a.em.emit(Oe,S(Ke,M,Ne,d,P(),B))),B}return k(),j(),G})()}const qe=e=>e.current;function Ie(s,N,O,z,P=t,K,D=0){var L;O={...O};let Q=!!P,G=d;if(P)try{const e=r(N,Te(s)),a=o(e),d=a.l1Cache.get(n(a.id,c(e)));if(d&&!l(d,i)){const[e,t]=d;(!t||t>u())&&(G=e)}Q=!!f(null!==(L=O.force)&&void 0!==L?L:t)||!G}catch(he){}const{create:M,effectRequest:B,ref:J,objectify:V,exposeProvider:X,transformState2Proxy:$,__referingObj:Y}=function(r,s={trackedKeys:{},bindError:t,initialRequest:t,...p()}){const o=e=>r.ref?r.ref(e):{current:e};s=o(s).current;const n=e=>(r.export||q)(e,s),c=t=>{if(!x(r.memorize))return t;const a=r.memorize(t);return a.memorized=e,a},{dehydrate:i}=r,u=(e,t,a)=>e!==i(t,a,s)&&s.trackedKeys[a]&&r.update(e,t,a,s),d=e=>R(e,e=>l(e,U)?e.e:e),f=[],m={};return{create:(e,t)=>(C(f,t),S(w,r.create(e,t,s),t,e=>i(e,t,s),n,(e,a)=>u(a,e,t))),computed:(t,a,o)=>(g(a,t=>{t.k&&(m[t.k]=e)}),S(U,r.computed(t,d(a),o,s),o,e=>i(e,o,s),n)),effectRequest:e=>r.effectRequest(e,s),ref:o,watch:(e,t)=>r.watch(d(e),t,s),onMounted:e=>r.onMounted(e,s),onUnmounted:e=>r.onUnmounted(e,s),memorize:c,__referingObj:s,exposeProvider:r=>{const o={},n={},i=[];for(const t in r){const a=r[t];if(x(a)&&!s.trackedKeys[t])o[t]=t.startsWith("on")?(...e)=>(a(...e),v):a.memorized?a:c(a);else{k(["uploading","downloading"],t)||t.startsWith("__")||C(i,t);const r=l(a,U);r&&(n[t]=a.s),I.defineProperty(o,t,{get:()=>(s.trackedKeys[t]=e,r?a.e:a),set:H,enumerable:e,configurable:e})}}const{update:d,__proxyState:p}=o;s.trackedKeys={...m},s.bindError=t;const{then:h}=o,_={__referingObj:s,update:c(e=>{A(e).forEach(t=>{k(f,t)?u(e[t],n[t],t):t in o&&x(d)&&d({[t]:e[t]})})}),__proxyState:c(t=>k(f,t)&&l(r[t],U)?(s.trackedKeys[t]=e,r[t]):p(t)),then(t,a){g(i,t=>{s.trackedKeys[t]=e});const r=()=>{F(v,"then"),t(v)};x(h)?h(r,a):r()}},v=a(o,_);return v},objectify:(e,t)=>e.reduce((e,a)=>(e[a.k]=t?a[t]:a,e),{}),transformState2Proxy:(e,t)=>S(w,e,t,e=>i(e,t,s),n,(e,a)=>u(a,e,t))}}(m(),O.__referingObj),Z={total:0,loaded:0},{managedStates:ee={}}=O,te=((e,t)=>{const a={};for(const r in e)a[r]=t(e[r],r,e);return a})(ee,(e,t)=>$(e,t)),ae=M(null!=G?G:x(z)?z():z,"data"),re=M(Q,"loading"),se=M(d,"error"),oe=M({...Z},"downloading"),ne=M({...Z},"uploading"),ce=V([ae,re,se,oe,ne]),le=h(),ie=qe(J(((e,t,a,r)=>({m:d,rf:{},fs:{},em:a,ht:e,c:t,ro:r,ms:{}}))(s,O,le,Y)));ie.fs=ce,ie.em=le,ie.c=O,ie.ms={...ce,...te};const ue=(e=N,t)=>De(ie,e,t),de=J(d),fe=J(t),pe=qe(J(_())),me=(t=Y,a)=>{pe(()=>{j.ssr&&!qe(de)||(Y.initialRequest=fe.current=e,y(ue(a),()=>{var e;null===(e=qe(de))||void 0===e||e.resolve()},e=>{var a;if(!t.bindError&&!t.trackedKeys.error&&!qe(de))throw e;null===(a=qe(de))||void 0===a||a.reject(e)}))})};J(Se((e,t,a)=>me(t,a),e=>T(e)?W(D)?D[e]:D:0)),B({handler:()=>me(Y),removeStates:()=>{g(v(ie.rf),e=>e())},frontStates:{...ce,...te},watchingStates:K,immediate:null!=P?P:e});const xe=X({...V([ae,re,se,oe,ne]),abort:()=>ie.m&&ie.m.abort(),send:(e,t)=>ue(t,e),onSuccess(e){le.on(je,e)},onError(t){Y.bindError=e,le.on(Ne,t)},onComplete(e){le.on(Oe,e)},then(e,t){const{promise:a,resolve:r,reject:s}=E();de.current={resolve:r,reject:s},b(()=>{!fe.current&&r()},10),y(a,()=>{e(xe)},t)}});return xe}var We,Le,Qe,Ge;(Le=We||(We={}))[Le.CONNECTING=0]="CONNECTING",Le[Le.OPEN=1]="OPEN",Le[Le.CLOSED=2]="CLOSED",(Ge=Qe||(Qe={})).Open="open",Ge.Error="error",Ge.Message="message",Ge.Close="close";const Me=ge(L({__name:"result",setup(t){const r=Q(),s=be(),o=G("activity-result-message-box"),n=M(),{data:c,send:l}=function(t,r={}){const{immediate:s=e,initialData:o}=r,n=Ie(we.USE_REQUEST,t,r,o,!!s),{send:c}=n;return a(n,{send:(...e)=>c(e)})}(B.app.getActivity,{immediate:!1}),i=M(!1);function u(){r.replaceAll({name:"profit"})}ye(async e=>{const{id:t,pageUUID:a}=e||{},r=Number.parseInt(t,10);t&&!Number.isNaN(r)&&(a&&(n.value=s.withdrawRouteState(a)),Y()&&(i.value=!0,setTimeout(()=>{o.alert({title:"提示"})})),l({params:{id:r}}))});const d=M(),f=M(0),p=M([0]);function m(){"number"==typeof d.value&&(f.value=d.value)}function x(){f.value=0}function h(){(Y()||/micromessenger/i.test(window.navigator.userAgent))&&_e({icon:"error",title:"微信内可以长按二维码来保存图片哦！",duration:6e3});const e=document.createElement("a");e.download="场印.png",e.href=xe,document.body.append(e),e.click(),e.remove()}return J(()=>{const e=Z().windowHeight;d.value=1*e,p.value=[0,d.value]}),(e,t)=>{const a=re,s=Ee,o=se,l=ve,d=ae,_=ue,g=me,v=fe,E=he,b=$("layout-default-uni");return ee(),V(b,null,{default:X(()=>[te(d,{class:"p-64rpx bg-#f5f5f5 flex h-screen w-screen flex-col items-center justify-center"},{default:X(()=>[te(d,{class:"result-card bg-#fff rounded-24rpx py-64rpx px-32rpx gap-16rpx flex w-full flex-col items-center"},{default:X(()=>[te(a,{name:"check-outline",size:"148rpx",color:"#34d19d"}),te(d,{class:"gap-2rpx flex flex-col items-center"},{default:X(()=>{var e,t;return[te(s,{text:"恭喜您！"}),te(o,{text:`已成功参加“${(null==(t=null==(e=oe(c))?void 0:e.data)?void 0:t.name)||""}”活动`},null,8,["text"]),te(d,{class:"gap-4rpx mt-4rpx flex flex-col"},{default:X(()=>{var e;return[(ee(!0),ne(ce,null,le(((null==(e=oe(n))?void 0:e.succeedProducts)||[]).filter(e=>e.id&&2===Number(e.productSpuType)),e=>(ee(),V(d,{key:e.id,class:"bg-#FF6A001A rounded-96rpx py-4rpx px-12rpx",onClick:t=>{return a=e.id,void(i.value||r.push({name:"profitDetail",params:{id:String(a)}}));var a}},{default:X(()=>[te(l,{"custom-class":"text-24rpx leading-28rpx",text:e.productSpuName},null,8,["text"])]),_:2},1032,["onClick"]))),128))]}),_:1})]}),_:1}),te(d,{class:"gap-24rpx px-24rpx mt-48rpx flex w-full flex-col"},{default:X(()=>{var e,t;return[!oe(i)&&((null==(t=null==(e=oe(c))?void 0:e.data)?void 0:t.issueVoucher)||[]).length>0?(ee(),V(_,{key:0,block:"",onClick:u},{default:X(()=>[de(" 查看我的权益 ")]),_:1})):ie("",!0),te(_,{block:"",plain:"",onClick:oe(r).back},{default:X(()=>[de("返回活动详情")]),_:1},8,["onClick"])]}),_:1}),te(d,{class:"mt-24rpx"},{default:X(()=>[te(d,{class:"text-24rpx text-#545454"},{default:X(()=>[de(" 提示：为方便下次使用，请及时 "),te(o,{"custom-class":"mx-4rpx",text:"[点我保存]",color:"var(--wot-color-theme)",onClick:m}),de(" 网站 ")]),_:1})]),_:1})]),_:1}),te(v,{"custom-class":"!z-999 bg-black rounded-none",height:oe(f),"onUpdate:height":t[0]||(t[0]=e=>pe(f)?f.value=e:null),anchors:oe(p),"safe-area-inset-bottom":""},{default:X(()=>[te(d,{class:"gap-24rpx relative flex h-full w-full flex-col items-center"},{default:X(()=>[te(d,{class:"h-1062rpx w-750rpx relative"},{default:X(()=>[te(g,{src:oe(xe),width:"100%",height:"100%"},null,8,["src"]),te(d,{class:"top-18rpx min-w-560rpx border-2rpx border-#ffffff66 rounded-32rpx py-4rpx px-24rpx bg-[rgba(241, 249, 255, 0.05)] absolute left-1/2 translate-x-[-50%] shadow-[0_4px_24rpx_0_rgba(0,0,0,0.08)]"},{default:X(()=>[te(o,{"custom-class":" text-center ",text:"手机截图保存本页面，或点击“保存至相册”",size:"26rpx"})]),_:1})]),_:1}),te(d,{class:"gap-24rpx bottom-24rpx sticky flex"},{default:X(()=>[te(_,{onClick:h},{default:X(()=>[de("保存至相册")]),_:1}),te(_,{type:"info",onClick:x},{default:X(()=>[de(" 取消 ")]),_:1})]),_:1})]),_:1})]),_:1},8,["height","anchors"]),te(E,{selector:"activity-result-message-box"},{default:X(()=>[te(d,null,{default:X(()=>[te(d,null,{default:X(()=>[de("权益马上将由短信方式递送给您")]),_:1}),te(d,{class:"text-26rpx text-#fa8c16"},{default:X(()=>[de(" 未收到短信可以保存数根官网扫码进入查看 ")]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})}}}),[["__scopeId","data-v-d48a1a92"]]);export{Me as default};
