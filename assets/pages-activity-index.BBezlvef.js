import{_ as t}from"./BannerView.vue_vue_type_script_setup_true_lang.C5Yo6SAN.js";import{_ as a}from"./ActivityListItem.CcKyN523.js";import{u as i,_ as s}from"./usePaged._CJwzs43.js";import{d as e,H as r,c as o,w as n,r as u,a as l,b as p,B as c,e as d,v as m,S as v,T as f,U as y,P as g}from"./index-B1Tc0IQL.js";import{l as h}from"./activity-banner.C3kWKCRr.js";import{u as _}from"./useLocation.Dnyet2w1.js";import"./wd-divider.BYGEIHSl.js";import"./Avatar.vue_vue_type_script_setup_true_lang.BKPbwCsj.js";import"./PyTitle.ByCrNrVh.js";const w=e({__name:"index",setup(e){const w=r(),{update:b,longitude:x,latitude:L,hasFirstErrorToast:j,firstErrorToast:P}=_(),A=t=>({id:(null==t?void 0:t.id)||Date.now().toString(),img:null==t?void 0:t.picUrl,title:(null==t?void 0:t.name)||"未命名数根"}),S=t=>{const a=[];t.issueProduct&&(Array.isArray(t.issueProduct)?a.push(...t.issueProduct.map(t=>A(t))):a.push(A(t.issueProduct)));const i=[];var s;t.issueVoucher&&(Array.isArray(t.issueVoucher)?i.push(...t.issueVoucher.map(t=>A(t))):i.push({id:(null==(s=t.issueVoucher)?void 0:s.id)||Date.now().toString(),img:null==s?void 0:s.picUrl,title:(null==s?void 0:s.name)||"未命名权益"}));const e=[];return t.attendedUsers&&t.attendedUsers.forEach(t=>{e.push((t=>({avatar:null==t?void 0:t.avatar}))(t))}),{...t,pythrootList:a,profitList:i,participants:e}};const{list:T}=i(async function(t){const a="number"==typeof L.value?String(L.value):void 0,i="number"==typeof x.value?String(x.value):void 0;a&&i||j.value?await b({toast:!1,forceUpdate:"onPullDownRefresh"===(null==t?void 0:t.sourceType)}):(P(),await b({toast:!0}));const s=await g.app.getActivityPage({params:{type:1,myLocationLatitude:a,myLocationLongitude:i,...t}}),{code:e,data:r}=s||{};if(0!==e||!r)throw new Error("获取数据失败");let o=r.list||[];return o=o.map(t=>S(t)),{list:o,total:r.total||0}});return(i,e)=>{const r=s,g=d,_=a,b=t,x=u("layout-tabbar-uni");return l(),o(x,null,{default:n(()=>[p(b,{"custom-class":"pb-228rpx bg-#EFF2F5","banner-height":"364rpx","banner-src":c(h)},{default:n(()=>[p(g,{class:"p-30rpx gap-20rpx mt-[-278rpx] flex flex-col bg-transparent"},{default:n(()=>[0===c(T).length?(l(),o(g,{key:0,class:"mt-260rpx"},{default:n(()=>[p(r)]),_:1})):m("",!0),(l(!0),v(f,null,y(c(T),t=>(l(),o(_,{key:t.id,"attend-count":t.attendCount,"cover-img-src":t.picUrl||"",title:t.name,location:t.address||"","start-time":t.startTime,"end-time":t.endTime,participants:t.participants,"pythroot-list":t.pythrootList,"profit-list":t.profitList,distance:t.distance,"extra-button-text":"马上参与","time-status":t.timeStatus,onJoinNow:a=>{return i=t.id,void w.push({name:"activityDetail",params:{id:String(i)}});var i}},null,8,["attend-count","cover-img-src","title","location","start-time","end-time","participants","pythroot-list","profit-list","distance","time-status","onJoinNow"]))),128))]),_:1})]),_:1},8,["banner-src"])]),_:1})}}});export{w as default};
