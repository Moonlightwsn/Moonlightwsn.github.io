import{d as e,C as t,H as a,q as l,D as r,O as s,Q as o,c as n,w as u,r as i,R as c,a as d,b as p,e as v,n as A,B as m,I as f,G as g,v as x,S as y,T as h,U as w,V as b,J as B,z as k,A as C,W as U,X as S,Y as _,Z as R,$ as I,F as j,P as V,M as Q,a0 as E}from"./index-DSHRyYKW.js";import{_ as T}from"./BannerView.vue_vue_type_script_setup_true_lang.CpDtaUpF.js";import{_ as N}from"./QrScannerView.FitkfAbL.js";import{_ as z,a as O}from"./HtmlCard.vue_vue_type_script_setup_true_lang.-EneZRvo.js";import{_ as P}from"./GradientText.vue_vue_type_script_setup_true_lang.CZuGddRZ.js";import{_ as D}from"./Avatar.vue_vue_type_script_setup_true_lang.VqNKzB0y.js";import{_ as F}from"./PyTitle.BzWse8en.js";import{G as H}from"./gift.CnwWG0IK.js";import{T as M}from"./ticket.Bwxup39T.js";import{u as J}from"./usePageOptions.B_3vrcgE.js";import{u as W}from"./useRouteState.CWpGcnlJ.js";import{u as K}from"./useLocation.DZDgsVXu.js";const Z="YYYY年MM月DD日 HH时mm分",L=e({__name:"detail-new",setup(e){const{confirm:L}=t(),X=a(),Y=W(),{longitude:G,latitude:q,update:$}=K(),ee=l(()=>{var e,t;return[{key:"pythroot",icon:M,title:"可领数根",bg:"#29A2FB1A",products:(null==(e=le.value)?void 0:e.issueProduct)||[]},{key:"profit",icon:H,title:"可领权益",bg:"#FF6A001A",products:(null==(t=le.value)?void 0:t.issueVoucher)||[]}]}),te=r(),ae=r(),le=r(null),re=r(!1),se=r(),oe=r({errorMsg:"",flag:!1}),ne=l(()=>{var e;if("boolean"!=typeof se.value)return"";if(se.value)return"已参与";const t=Number(null==(e=le.value)?void 0:e.type);return 0===t?"线下扫码":1===t?"签到参与":2===t?"立即领取":""});function ue(e,t){const a=Y.depositRouteState(t);X.push({name:"activityResult",params:{id:String(e),pageUUID:a}})}async function ie(){var e;if("preview"===ae.value)return;if(!_().value)return void L({title:"用户未登录",msg:"请登录后再来参加活动！",cancelButtonText:"继续浏览",confirmButtonText:"去登录",success(){R(X.route.value),I()}});if(!(null==(e=le.value)?void 0:e.id))return void j({icon:"error",title:"活动数据未加载完成，请稍后重试"});if(!oe.value.flag)return void(1008005009===oe.value.errorCode?L({title:"数字身份保护说明",msg:"你的账号里数字资产（数根、权益）已经超出安全范围啦。为了保护好这些资产，需要先领取实名数字身份，之后就能顺利参加活动、获取新的数根和权益啦～",cancelButtonText:"放弃",confirmButtonText:"领取数字身份",success(){X.push({name:"digitalIdCard"})}}):oe.value.errorMsg&&j({icon:"error",title:oe.value.errorMsg}));const{id:t,type:a}=le.value;switch(a){case 0:"number"==typeof pe.value&&(ve.value=pe.value);break;case 1:X.push({name:"activityAttendance",params:{id:String(t)}});break;case 2:{re.value=!0;const e=await V.app.createActivityAttendance({data:{channel:Q()?"weapp":"h5",activityId:t}}).catch(e=>{1008005009===(null==e?void 0:e.code)&&L({title:"数字身份保护说明",msg:"你的账号里数字资产（数根、权益）已经超出安全范围啦。为了保护好这些资产，需要先领取实名数字身份，之后就能顺利参加活动、获取新的数根和权益啦～",cancelButtonText:"放弃",confirmButtonText:"领取数字身份",success(){X.push({name:"digitalIdCard"})}})}).finally(()=>re.value=!1);0===(null==e?void 0:e.code)&&(null==e?void 0:e.data)&&(j({icon:"success",title:"签到成功"}),se.value=!0,ue(t,e.data));break}}}function ce(e){var t;const a=_();!function(){const e=Date.now(),{endTime:t}=le.value||{},a=Number(t);if(Number.isNaN(a)||!(e<a))throw new Error("活动已过期");if(se.value)throw new Error("您已参加过该活动")}(),L({title:"参加活动",msg:`确认要参加${(null==(t=le.value)?void 0:t.name)||""}活动么？`,confirmButtonText:a.value?"确认参加":"登录并参加",cancelButtonText:"放弃",success(){a.value?async function(e){var t;const a=null==(t=null==le?void 0:le.value)?void 0:t.id;if(e&&a)try{await $({toast:!0,forceUpdate:!0});const t=await V.app.createActivityAttendanceWithQRCode({data:{machineCode:e,locationLongitude:null===G.value?void 0:String(G.value),locationLatitude:null===q.value?void 0:String(q.value)}}).catch(e=>{1008005009===(null==e?void 0:e.code)&&L({title:"数字身份保护说明",msg:"你的账号里数字资产（数根、权益）已经超出安全范围啦。为了保护好这些资产，需要先领取实名数字身份，之后就能顺利参加活动、获取新的数根和权益啦～",cancelButtonText:"放弃",confirmButtonText:"领取数字身份",success(){X.push({name:"digitalIdCard"})}})});0===(null==t?void 0:t.code)&&(null==t?void 0:t.data)&&(j({icon:"success",title:"参加活动成功"}),ue(a,t.data))}catch(l){j({icon:"error",title:l.message||"未知错误"})}}(e):(R(X.route.value),I())}})}async function de(){var e;if(null==(e=te.value)?void 0:e.id)try{let e=function(){"scanQrcode"===ae.value&&l&&ce(l)};const{id:t,scene:a,machineCode:l}=te.value;ae.value=a||void 0;const r=Number.parseInt(t,10);if(Number.isNaN(r))return void j({icon:"error",title:"无效的活动ID"});await async function(e){const t=await("preview"===ae.value?V.app.previewActivity:V.app.getActivity)({params:{id:e}});return(null==t?void 0:t.data)?le.value=t.data:(le.value=null,j({icon:"error",title:"没有获取到权益详情"})),le.value}(r),await async function(e){var t,a,l,r;const s=_();if(!s.value||"preview"===ae.value)return se.value=!1,oe.value.flag=!1,oe.value.errorCode=void 0,void(oe.value.errorMsg="");const o=await V.app.checkActivityAttended({params:{activityId:e},meta:{ignore:{unauthorized:!0,showToast:!0}}}).catch(e=>(401!==(null==e?void 0:e.code)&&403!==(null==e?void 0:e.code)||(s.value=""),{code:-1,data:{attendanceFlag:!1,canAttendanceFlag:!1,code:void 0,msg:""}}));return se.value=(null==(t=null==o?void 0:o.data)?void 0:t.attendanceFlag)||!1,oe.value.flag=(null==(a=null==o?void 0:o.data)?void 0:a.canAttendanceFlag)||!1,oe.value.errorCode=null==(l=null==o?void 0:o.data)?void 0:l.code,oe.value.errorMsg=(null==(r=null==o?void 0:o.data)?void 0:r.msg)||"",se.value}(r),setTimeout(()=>{e()},0)}catch(t){j({icon:"error",title:t.message||"未知错误"})}}J(async e=>{te.value=e,de()}),s(()=>{de()});const pe=r(),ve=r(0),Ae=r([0]);function me(){ve.value=0}async function fe(e=""){try{const{path:t,queryParams:a}=E(e);if("/pages/checkout/qrcode"!==t)throw new Error("不合法的二维码");await async function(e){var t;if(!e)throw new Error("没有识别到活动");const a=await V.app.queryQRCodeInfo({params:{machineCode:e,manualCode:""}}),{entityId:l,type:r}=a.data||{};if(!l||1!==Number(r))throw new Error("不合法的二维码");me(),l===(null==(t=le.value)?void 0:t.id)?ce(e):X.replace({name:"activityDetail",params:{id:String(l),scene:"scanQrcode",machineCode:e}})}(null==a?void 0:a.machineCode)}catch(t){me(),j({icon:"error",title:t.message||"不合法的二维码"})}}return o(()=>{const e=c().windowHeight;pe.value=.9*e,Ae.value=[0,pe.value]}),(e,t)=>{const a=F,l=v,r=z,s=f,o=D,c=P,_=O,R=B,I=N,j=S,V=T,Q=i("layout-default-uni");return d(),n(Q,null,{default:u(()=>{var e;return[p(V,{"custom-class":"bg-#f5f5f5 pb-154rpx !min-h-[calc(100vh+240rpx)]","banner-class":"rounded-b-100rpx overflow-hidden !left-1/2 !translate-x-[-50%] !w-811rpx ","banner-height":"422rpx","banner-src":null==(e=le.value)?void 0:e.picUrl},{default:u(()=>[p(l,{class:"px-36rpx mt-[-96rpx]"},{default:u(()=>{var e;return[p(l,{class:"min-h-600rpx pt-26rpx px-40rpx pb-64rpx flex w-full flex-col",style:A({backgroundImage:`url(${m("/assets/activity-detail-card-bg-Xors4_7S.png")})`,backgroundSize:"100% 100%"})},{default:u(()=>{var e;return[p(a,{"custom-class":"!font-600",color:"#37445D","line-height":"normal",size:"34rpx",text:null==(e=le.value)?void 0:e.name},null,8,["text"]),p(l,{class:"my-18rpx bg-#E2E2E2 h-2rpx w-full scale-y-50"}),p(l,{class:"gap-12rpx flex flex-col"},{default:u(()=>[p(l,{class:"gap-14rpx flex items-start"},{default:u(()=>{var e;return[p(l,{class:"w-168rpx flex flex-shrink-0 items-center"},{default:u(()=>[p(r,{src:m("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABYAAAAWCAYAAADEtGw7AAAACXBIWXMAABYlAAAWJQFJUiTwAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAALoSURBVHgBrZXPTxpREMdndh+JNWnC3ZiCPdfQxCrpRQiY9Fa8tdUWuPUmvfUm3nor3LzJD2N6pLcmgqxJD4gmgn+A7MHeadJYE2GnMyj08VObdJIlvHkzn533nXmAcA8LBCLuK5hyy/cpuGpaVqF5Vw5O2lwIryVMwJccFujfoZrjOOnjg73MP4H9gVceMl1l3vUQwCEHFZBhHSSgj30R9i3zwsb2dbBifbHvBAvUUa5TRGwiOfFKcdca+fIXMQ+1nTIRuQnbweP9vdpYcK9SA+HBtfHUsjITtezCwSF40Db74g090DFVUo6PphHUg6R5z1be+OTR4yvfMrbEEoL7UrUS+l4fGJAbhZCRhK5riRt4qR42DDJP5VkKvW3oL5BYAyjNyRuBQMw9BPaH1wOsi9uBdrrrWwy9jnDIZ/5qsZar3MCgyIRklkU2rSRLcn+plm8I7PCJudtNvQmI5gZ/1qrF/Gq1tFuQRor2skem6h1d/JJrAg2DOyCCwWZ5CZyvukO0l9EjRE9fLtBPHsVhKXijKU3o52KDD74Mg0boQSJ7IPaRMLor9ReMIoF7gbU+uZ1dRMgSwc5ieH3TaLWyHaZysTw8OUqlurnSH5YC2jeM/oqnWqrW0Ykg0vVV9vMZfuEWP0kGNjoPYAwdiOuTw2Mc4yrsE+0yGbp2MjasXVTveKWYS6IyvTIVDkJ8umV4Kwf5TK9ajuVbGuWTZXVhlL7gqlO/XU6UK9vhZbAHv6nOhhFGSu1ItdPXRkr3m/rCtmtXs3NP6qxucmZuHn6cnx3CBGNtNzk2ZhDFv5dztbFgsYvzM3t2zie/IclZr8++aNTro6ByI1nJT6z51lEpvz24b45KujivWzOP573j4P7QWhTQ2OaxS1dLuY+jGCPBYixDoQvXZelUylBucrZazL0flz/xH6QDCq2nuDkbBJTEm5uVkEqPSrnEpLw7wWL+8Lskgzdvlx+OivkU/C97vhLzyQ27b/wfWV5Kjq47K7QAAAAASUVORK5CYII=")},null,8,["src"]),p(s,{"custom-class":"flex-shrink-0 ml-10rpx",text:"活动地址：",color:"#37445D",size:"27rpx"})]),_:1}),p(s,{"custom-class":"font-300",text:(null==(e=le.value)?void 0:e.address)||"-"},null,8,["text"])]}),_:1}),p(l,{class:"gap-14rpx flex items-start"},{default:u(()=>[p(l,{class:"w-168rpx flex flex-shrink-0 items-center"},{default:u(()=>[p(r,{src:m("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAI4SURBVHgBpVQ9T9tgEL577XagDNnbKh97iysVyFarmLkZK5SQ8A/arVucrVvpL2iUIGZ3TijO1NB0aOieGgnmgtSPAezj7oVICbHBgmdIfK/vHt9799whJOC5U7YNoiooZRNBBgEyAPSDAAKKos+DL9vNuDiMJ8JP/CbH5gER+fwcaGcSUrTZXgCCIKKwcZV4irDolOsE6HIWPQXk9rtbPsRgcXXNUmS4/PgqAtgcdNtvZ5yEbNmp0JKz7kJKFNlXYhadyofxmaG/+HKthqg2ObvGt27LTUt4OBr6jwsW8jXfPSo8OTka/ezrKy+vVH6BQtjrtPJXg2y7lPljzlvfE66v453KLpfJmjsz8mpppVySBoQUbcQ5/zPmbQNwF64BAjVEBf/N05pimwkxSMqAFGbgBlw2zydQtuICZFkaQ7grmINltSAZ5kWwcFcgBVI6M62/yGPSjjB8NuhszyQihL+RMJtE9ODU8P7eC2PO7wdTB4Q5/g1MHqEeIVTZiO2y7zeP+a8JNwHhBV9hKE3xpOUyw3BLFO3XOWa0WMqe0i1n2bDW6nBLRIbpCke/024qne2FqO3JmUydHe8ARKyKuMXWs3w42g/GM/mw8BSORvu9tGSynbghH/e67fc6uWmHdV5dVJddFyJtJE2P3pkAdb0bhWyn9Wb8bmbBFlcrNZJ6EuWEGGSkkA60M1FWNjif59jn2OBSfd3Z8ibjERKgl4aCEkZoEV7olOt0ojc4gDcXmv6lpKZwDuAa6iTxZNykAAAAAElFTkSuQmCC")},null,8,["src"]),p(s,{"custom-class":"flex-shrink-0 ml-14rpx",text:"活动时间：",color:"#37445D",size:"27rpx"})]),_:1}),p(l,{class:"flex flex-grow flex-col"},{default:u(()=>{var e,t;return[p(s,{"custom-class":"font-300",text:m(g)(null==(e=le.value)?void 0:e.startTime,Z)},null,8,["text"]),p(s,{"custom-class":"font-300",text:m(g)(null==(t=le.value)?void 0:t.endTime,Z)},null,8,["text"])]}),_:1})]),_:1}),p(l,{class:"gap-14rpx flex items-center"},{default:u(()=>{var e,t;return[p(l,{class:"w-168rpx flex flex-shrink-0 items-center"},{default:u(()=>[p(r,{src:m("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAwAAAAMCAYAAABWdVznAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAD1SURBVHgBlVBLTgJBEH1VRYzs5gh6AsaFsrQx4163qJEjeAVvoDdASFzrGhJ76WfhcAO9waxg0zNFQxhoPsmEt+hU9XuVl/eAChhzFYV7rRyayc0DIPeAZlD8Kek/AecTpSNPH5c6nj2nF+2OksR1x62vYb9VcP7sCVt3tWtPj4zpROsOIiDNU2t72Wz9GbymgbMdH6jx49vSQUQslBvYAQKllMOs9gXOkttfgr5s5vCSBhPePwf97lpofzpSleh72DuZ57psx6IcHTp5srabbbVEqmlRuCUR5gjB5SBOLRPH2AfN5O6jSsObH2HnlQe+pUdUYAoqSVReBzLi1AAAAABJRU5ErkJggg==")},null,8,["src"]),p(s,{"custom-class":"flex-shrink-0 ml-10rpx",text:"主办方：",color:"#37445D",size:"27rpx"})]),_:1}),(null==(e=le.value)?void 0:e.sponsorLogoUrl)?(d(),n(o,{key:0,"custom-class":"flex-shrink-0",src:le.value.sponsorLogoUrl,border:!0,size:"72rpx"},null,8,["src"])):x("",!0),p(s,{"custom-class":"font-300",lines:2,text:null==(t=le.value)?void 0:t.sponsorName,color:"#000000",size:"27rpx"},null,8,["text"])]}),_:1})]),_:1}),p(l,{class:"mt-70rpx gap-16rpx flex flex-col"},{default:u(()=>[(d(!0),y(h,null,w(m(ee),e=>(d(),n(l,{key:e.key},{default:u(()=>[p(l,{class:"gap-24rpx mb-28rpx flex items-center"},{default:u(()=>[p(r,{src:e.icon,width:"36rpx",height:"36rpx"},null,8,["src"]),p(a,{text:e.title,color:"#37445D",size:"27rpx","line-height":"normal"},null,8,["text"])]),_:2},1024),p(l,{class:"flex flex-row flex-wrap"},{default:u(()=>[(d(!0),y(h,null,w(e.products,t=>(d(),n(l,{key:t.id,class:"max-w-1/2 mb-16rpx basis-1/2"},{default:u(()=>[p(l,{class:"pr-24rpx pl-80rpx py-2rpx relative inline-flex max-w-full rounded-full",style:A({background:e.bg}),onClick:a=>function(e,t){if("preview"!==ae.value)switch(t){case"profit":X.push({name:"profitDetail",params:{pId:String(e),type:"product"}});break;case"pythroot":X.push({name:"pythrootDetail",params:{pId:String(e),type:"product"}})}}(t.productId,e.key)},{default:u(()=>[t.picUrl?(d(),n(o,{key:0,"custom-class":"!absolute top-1/2 left-0 translate-y-[-50%] bg-#f5f5f5",src:t.picUrl,border:!0,size:"60rpx"},null,8,["src"])):x("",!0),p(c,{"custom-class":"min-w-120rpx  leading-38rpx text-center font-500 text-24rpx truncate",text:t.name,from:"pythroot"===e.key?"#09DAFF":void 0,to:"pythroot"===e.key?"#29A2FB":void 0},null,8,["text","from","to"])]),_:2},1032,["style","onClick"])]),_:2},1024))),128))]),_:2},1024)]),_:2},1024))),128))]),_:1})]}),_:1},8,["style"]),p(_,{"custom-class":"mx-8rpx mt-28rpx",title:"详细介绍","dompurify-html":(null==(e=le.value)?void 0:e.description)||"<p>暂无详细介绍</p>"},null,8,["dompurify-html"])]}),_:1}),p(l,{class:"py-36rpx px-54rpx z-999 fixed bottom-0 left-0 right-0"},{default:u(()=>[b(p(R,{class:"w-full !opacity-100 shadow-[2rpx_2rpx_2rpx_0_rgba(0,0,0,0.15)]",onClick:ie,block:"",loading:re.value,disabled:se.value,type:se.value?"info":"primary"},{default:u(()=>[k(C(m(ne)),1)]),_:1},8,["loading","disabled","type"]),[[U,Boolean(m(ne))]])]),_:1}),p(j,{"custom-class":"!z-1000 bg-black rounded-none",height:ve.value,"onUpdate:height":t[0]||(t[0]=e=>ve.value=e),anchors:Ae.value,"safe-area-inset-bottom":""},{default:u(()=>["number"==typeof pe.value&&ve.value>100?(d(),n(I,{key:0,onResult:fe})):x("",!0)]),_:1},8,["height","anchors"])]),_:1},8,["banner-src"])]}),_:1})}}});export{L as default};
