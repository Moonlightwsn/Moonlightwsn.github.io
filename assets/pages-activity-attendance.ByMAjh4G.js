import{m as e,f as t,g as s,d as a,u as l,c as i,a as r,e as n,n as o,h as u,w as c,j as d,_ as p,k as f,l as _,p as v,q as m,s as x,t as y,b as g,v as w,x as b,y as h,z as k,A as $,H as j,B as C,r as S,C as I,P as N,D as z,E as B,F as A,G as D}from"./index-BAYT1_GE.js";import{_ as F}from"./BannerView.vue_vue_type_script_setup_true_lang.CfEUUJf5.js";import{_ as P,a as G}from"./wd-tab.B9rUGQsF.js";import{_ as L}from"./Descriptions.vue_vue_type_script_setup_true_lang.C2s6pP_d.js";import{_ as T}from"./PyText.vue_vue_type_script_setup_true_lang.na7fmCI6.js";import{_ as E}from"./PyTitle.BRdSQeXA.js";import{u as H}from"./usePageOptions.aM0KPUm6.js";import{u as U}from"./useLocation.UBtuxGQc.js";import{f as q}from"./index.DIv4z3yk.js";import"./wd-col.2q1mmHlU.js";import"./wd-text.DuK9VuY3.js";const O={...s,active:t(0),vertical:e(!1),dot:e(!1),space:String,alignCenter:e(!1)},V=Symbol("wd-steps"),J=p(a({name:"wd-steps",options:{addGlobalClass:!0,virtualHost:!0,styleIsolation:"shared"},props:O,setup(e){const t=e,{linkChildren:s}=l(V);return s({props:t}),(e,t)=>{const s=n;return r(),i(s,{class:u(`wd-steps ${e.customClass} ${e.vertical?"is-vertical":""}`),style:o(e.customStyle)},{default:c(()=>[d(e.$slots,"default",{},void 0,!0)]),_:3},8,["class","style"])}}}),[["__scopeId","data-v-fdf5188c"]]),K=p(a({name:"wd-step",options:{addGlobalClass:!0,virtualHost:!0,styleIsolation:"shared"},props:{...s,title:String,description:String,icon:String,status:String},setup(e){const t=e,{parent:s,index:a}=f(V),{translate:l}=_("steps"),p=v(()=>function(e){if(t.status)return t.status;if(s){const{active:t}=s.props;return Number(t)>e?"finished":Number(t)===e?"process":"wait"}return"wait"}(a.value)),j=v(()=>function(e){if(t.title)return t.title;switch(e){case"finished":return l("finished");case"error":return l("failed");case"process":return l("process");default:return l("wait")}}(p.value)),C=v(()=>{const e={};if(s){const{vertical:t,space:a}=s.props;t?x(a)&&(e.height=a):e.width=a||100/s.children.length+"%"}return`${m(e)}${t.customStyle}`}),S=v(()=>{if(x(s)){const{vertical:e,alignCenter:t}=s.props;return Boolean(!e&&t)}return!1}),I=v(()=>!!x(s)&&Boolean(s.props.vertical)),N=v(()=>!!x(s)&&Boolean(s.props.dot)),z=v(()=>x(s)?Number(s.children.length):0);return(e,t)=>{const s=n,l=b;return p.value?(r(),i(s,{key:0,class:u(`wd-step ${e.customClass} ${p.value?"is-"+p.value:""} ${S.value?"is-center":""}  ${I.value?"is-vertical":""}`),style:o(C.value)},{default:c(()=>[g(s,{class:u("wd-step__header  "+(N.value?"is-dot":""))},{default:c(()=>[g(s,{class:u("wd-step__icon  "+(N.value?"is-dot":e.icon||e.$slots.icon?"is-icon":"is-text"))},{default:c(()=>[N.value?(r(),i(s,{key:0,class:"wd-step__dot"})):e.$slots.icon?d(e.$slots,"icon",{key:1},void 0,!0):e.icon?(r(),i(w,{key:2,"custom-class":"wd-step__icon-inner",name:e.icon},null,8,["name"])):(r(),i(s,{key:3,class:"wd-step__icon-outer"},{default:c(()=>["finished"===p.value?(r(),i(w,{key:0,name:"check-bold"})):"error"===p.value?(r(),i(w,{key:1,name:"close-bold"})):(r(),i(l,{key:2},{default:c(()=>[h(k($(a)+1),1)]),_:1}))]),_:1}))]),_:3},8,["class"]),$(a)<z.value-1?(r(),i(s,{key:0,class:"wd-step__line"})):y("",!0)]),_:3},8,["class"]),g(s,{class:"wd-step__content"},{default:c(()=>[g(s,{class:u("wd-step__title "+(e.$slots.description||e.description?"is-description":""))},{default:c(()=>[e.$slots.title?d(e.$slots,"title",{key:0},void 0,!0):(r(),i(l,{key:1},{default:c(()=>[h(k(j.value),1)]),_:1}))]),_:3},8,["class"]),e.$slots.description||e.description?(r(),i(s,{key:0,class:"wd-step__description"},{default:c(()=>[e.$slots.description?d(e.$slots,"description",{key:0},void 0,!0):(r(),i(l,{key:1},{default:c(()=>[h(k(e.description),1)]),_:1}))]),_:3})):y("",!0)]),_:3})]),_:3},8,["class","style"])):y("",!0)}}}),[["__scopeId","data-v-b36f9026"]]),M=p(a({__name:"attendance",setup(e){const t=j(),s=C(null),a=C("");H(async e=>{if(null==e?void 0:e.id)try{const{id:t}=e,l=Number.parseInt(t,10);if(Number.isNaN(l))return void I({icon:"error",title:"无效的活动ID"});const i=await N.app.getActivity({params:{id:l}});(null==i?void 0:i.data)?(s.value=i.data,a.value=q(s.value.createTime)):(s.value=null,I({title:"没有获取到权益详情"}))}catch(t){console.error("获取活动详情失败:",t),I({icon:"error",title:"获取活动详情失败，请稍后重试"})}else I({icon:"error",title:"缺少活动ID参数"})});const{latitude:l,longitude:o,loading:u,update:d}=U(),p=v(()=>u.value?"正在获取定位...":"number"==typeof l.value&&"number"==typeof o.value?`纬度：${l.value.toFixed(6)}, 经度：${o.value.toFixed(6)}`:"请获取位置信息"),f=()=>{d().then(()=>{I({icon:"success",title:"位置获取成功"})})},_=async()=>{var e;if(!(null==(e=s.value)?void 0:e.id))return void I({icon:"error",title:"获取活动信息失败"});if(null===l.value||null===o.value)return void I({icon:"error",title:"请先获取位置信息"});A({title:"签到提交中..."});0===(await N.app.createActivityAttendance({data:{activityId:s.value.id,locationLatitude:l.value.toString(),locationLongitude:o.value.toString()}}).finally(()=>{D()})).code&&(I({icon:"success",title:"提交签到成功"}),t.back())};return(e,t)=>{const l=B,o=E,u=n,d=w,v=T,m=L,x=G,j=P,C=K,I=J,N=b,A=z,D=F,H=S("layout-default-uni");return r(),i(H,null,{default:c(()=>[g(D,{"custom-class":"pb-154rpx"},{header:c(()=>{var e;return[(null==(e=s.value)?void 0:e.picUrl)?(r(),i(l,{key:0,src:s.value.picUrl,width:"100%",height:"364rpx",mode:"aspectFill"},null,8,["src"])):y("",!0)]}),default:c(()=>[g(u,{class:"pt-10rpx px-30rpx h-full w-full bg-white"},{default:c(()=>[g(u,{class:"activity-info"},{default:c(()=>{var e;return[g(u,{class:"mb-16rpx gap-20rpx flex items-center justify-between"},{default:c(()=>{var e;return[g(o,{text:(null==(e=s.value)?void 0:e.name)||""},null,8,["text"]),g(u,{class:"px-16rpx py-8rpx text-28rpx rounded-full bg-blue-50 text-blue-400"},{default:c(()=>[h(" 进行中 ")]),_:1})]}),_:1}),g(m,{data:[{label:"活动地址：",icon:"location",value:null==(e=s.value)?void 0:e.address},{label:"活动时间：",icon:"time",value:a.value}],"label-span":10,"value-span":14},{label:c(({item:e})=>[g(u,{class:"gap-20rpx inline-flex items-center"},{default:c(()=>[g(u,{class:"w-36rpx h-36rpx inline-flex items-center justify-center"},{default:c(()=>[g(d,{name:e.icon,size:"location"===e.icon?"36rpx":"28rpx"},null,8,["name","size"])]),_:2},1024),g(v,{text:e.label},null,8,["text"])]),_:2},1024)]),_:1},8,["data"]),g(u,{class:"sign-step mt-60rpx"},{default:c(()=>[g(u,{class:"inline-flex"},{default:c(()=>[g(j,{type:"long"},{default:c(()=>[g(x,{title:"签到步骤"})]),_:1})]),_:1}),g(I,{class:"mt-40rpx",active:2,vertical:"",dot:""},{default:c(()=>[g(C,{title:"获取当前位置"}),g(C,{title:"提交签到"})]),_:1})]),_:1}),g(u,{class:"current-location"},{default:c(()=>[g(u,{class:"inline-flex"},{default:c(()=>[g(j,{type:"long"},{default:c(()=>[g(x,{title:"当前位置"})]),_:1})]),_:1}),g(u,{class:"location-card mt-40rpx py-30rpx px-20rpx flex items-center justify-between rounded-lg bg-gray-100"},{default:c(()=>[g(u,null,{default:c(()=>[g(u,{class:"gap-300rpx flex items-center"},{default:c(()=>[g(u,null,{default:c(()=>[g(d,{name:"location",size:"20",color:"#60a5fa "}),g(N,{class:"ml-2 font-medium"},{default:c(()=>[h("位置：")]),_:1})]),_:1}),g(A,{type:"text",class:"text-blue-400",onClick:f},{default:c(()=>[g(d,{name:"refresh1"}),g(N,{class:"ml-1"},{default:c(()=>[h("重新获取")]),_:1})]),_:1})]),_:1}),g(N,{class:"text-gray-500"},{default:c(()=>[h(k($(p)),1)]),_:1})]),_:1})]),_:1})]),_:1})]}),_:1})]),_:1}),g(u,{class:"py-36rpx px-54rpx z-999 fixed bottom-0 left-0 right-0 bg-white"},{default:c(()=>[g(A,{class:"w-full",onClick:_},{default:c(()=>[h(" 提交签到 ")]),_:1})]),_:1})]),_:1})]),_:1})}}}),[["__scopeId","data-v-842b5dff"]]);export{M as default};
