import{m as e,f as t,g as s,d as a,u as l,c as i,a as r,e as n,n as o,h as u,w as c,j as d,_ as p,k as f,l as _,p as v,q as m,s as x,t as y,b as g,v as w,x as b,y as h,z as k,A as $,H as j,B as C,C as I,r as S,D as N,P as z,E as B,F as A,G as D,I as F}from"./index-Bpal6X9u.js";import{_ as G}from"./BannerView.vue_vue_type_script_setup_true_lang.DzP9QOFw.js";import{_ as P,a as L}from"./wd-tab.qIZ6aAd6.js";import{_ as T}from"./Descriptions.vue_vue_type_script_setup_true_lang.CFQOq7FE.js";import{_ as E}from"./PyText.vue_vue_type_script_setup_true_lang.1L9IIHvr.js";import{_ as H}from"./PyTitle.Dn6RlDza.js";import{u as U}from"./usePageOptions.tLOhYwqs.js";import{u as q}from"./useLocation.CgbsylOY.js";import{f as O}from"./index.DM5hYbMc.js";import"./wd-col.BoohVz6c.js";import"./wd-text.COOnfa1A.js";const V={...s,active:t(0),vertical:e(!1),dot:e(!1),space:String,alignCenter:e(!1)},J=Symbol("wd-steps"),K=p(a({name:"wd-steps",options:{addGlobalClass:!0,virtualHost:!0,styleIsolation:"shared"},props:V,setup(e){const t=e,{linkChildren:s}=l(J);return s({props:t}),(e,t)=>{const s=n;return r(),i(s,{class:u(`wd-steps ${e.customClass} ${e.vertical?"is-vertical":""}`),style:o(e.customStyle)},{default:c(()=>[d(e.$slots,"default",{},void 0,!0)]),_:3},8,["class","style"])}}}),[["__scopeId","data-v-fdf5188c"]]),M=p(a({name:"wd-step",options:{addGlobalClass:!0,virtualHost:!0,styleIsolation:"shared"},props:{...s,title:String,description:String,icon:String,status:String},setup(e){const t=e,{parent:s,index:a}=f(J),{translate:l}=_("steps"),p=v(()=>function(e){if(t.status)return t.status;if(s){const{active:t}=s.props;return Number(t)>e?"finished":Number(t)===e?"process":"wait"}return"wait"}(a.value)),j=v(()=>function(e){if(t.title)return t.title;switch(e){case"finished":return l("finished");case"error":return l("failed");case"process":return l("process");default:return l("wait")}}(p.value)),C=v(()=>{const e={};if(s){const{vertical:t,space:a}=s.props;t?x(a)&&(e.height=a):e.width=a||100/s.children.length+"%"}return`${m(e)}${t.customStyle}`}),I=v(()=>{if(x(s)){const{vertical:e,alignCenter:t}=s.props;return Boolean(!e&&t)}return!1}),S=v(()=>!!x(s)&&Boolean(s.props.vertical)),N=v(()=>!!x(s)&&Boolean(s.props.dot)),z=v(()=>x(s)?Number(s.children.length):0);return(e,t)=>{const s=n,l=b;return p.value?(r(),i(s,{key:0,class:u(`wd-step ${e.customClass} ${p.value?"is-"+p.value:""} ${I.value?"is-center":""}  ${S.value?"is-vertical":""}`),style:o(C.value)},{default:c(()=>[g(s,{class:u("wd-step__header  "+(N.value?"is-dot":""))},{default:c(()=>[g(s,{class:u("wd-step__icon  "+(N.value?"is-dot":e.icon||e.$slots.icon?"is-icon":"is-text"))},{default:c(()=>[N.value?(r(),i(s,{key:0,class:"wd-step__dot"})):e.$slots.icon?d(e.$slots,"icon",{key:1},void 0,!0):e.icon?(r(),i(w,{key:2,"custom-class":"wd-step__icon-inner",name:e.icon},null,8,["name"])):(r(),i(s,{key:3,class:"wd-step__icon-outer"},{default:c(()=>["finished"===p.value?(r(),i(w,{key:0,name:"check-bold"})):"error"===p.value?(r(),i(w,{key:1,name:"close-bold"})):(r(),i(l,{key:2},{default:c(()=>[h(k($(a)+1),1)]),_:1}))]),_:1}))]),_:3},8,["class"]),$(a)<z.value-1?(r(),i(s,{key:0,class:"wd-step__line"})):y("",!0)]),_:3},8,["class"]),g(s,{class:"wd-step__content"},{default:c(()=>[g(s,{class:u("wd-step__title "+(e.$slots.description||e.description?"is-description":""))},{default:c(()=>[e.$slots.title?d(e.$slots,"title",{key:0},void 0,!0):(r(),i(l,{key:1},{default:c(()=>[h(k(j.value),1)]),_:1}))]),_:3},8,["class"]),e.$slots.description||e.description?(r(),i(s,{key:0,class:"wd-step__description"},{default:c(()=>[e.$slots.description?d(e.$slots,"description",{key:0},void 0,!0):(r(),i(l,{key:1},{default:c(()=>[h(k(e.description),1)]),_:1}))]),_:3})):y("",!0)]),_:3})]),_:3},8,["class","style"])):y("",!0)}}}),[["__scopeId","data-v-b36f9026"]]),Q=p(a({__name:"attendance",setup(e){const t=j(),s=C(null),a=C("");U(async e=>{if(null==e?void 0:e.id)try{const{id:t}=e,l=Number.parseInt(t,10);if(Number.isNaN(l))return void N({icon:"error",title:"无效的活动ID"});const i=await z.app.getActivity({params:{id:l}});(null==i?void 0:i.data)?(s.value=i.data,a.value=O(s.value.createTime)):(s.value=null,N({title:"没有获取到权益详情"}))}catch(t){console.error("获取活动详情失败:",t),N({icon:"error",title:"获取活动详情失败，请稍后重试"})}else N({icon:"error",title:"缺少活动ID参数"})});const{latitude:l,longitude:o,loading:u,update:d}=q(),p=v(()=>u.value?"正在获取定位...":"number"==typeof l.value&&"number"==typeof o.value?`纬度：${l.value.toFixed(6)}, 经度：${o.value.toFixed(6)}`:"请获取位置信息");I(()=>{console.log("线上签到：",l.value,o.value,u.value,p.value)});const f=()=>{d().then(()=>{N({icon:"success",title:"位置获取成功"})})},_=async()=>{var e;if(!(null==(e=s.value)?void 0:e.id))return void N({icon:"error",title:"获取活动信息失败"});if(null===l.value||null===o.value)return void N({icon:"error",title:"请先获取位置信息"});D({title:"签到提交中..."});0===(await z.app.createActivityAttendance({data:{activityId:s.value.id,locationLatitude:l.value.toString(),locationLongitude:o.value.toString()}}).finally(()=>{F()})).code&&(N({icon:"success",title:"提交签到成功"}),t.back())};return(e,t)=>{const l=A,o=H,u=n,d=w,v=E,m=T,x=L,j=P,C=M,I=K,N=b,z=B,D=G,F=S("layout-default-uni");return r(),i(F,null,{default:c(()=>[g(D,{"custom-class":"pb-154rpx"},{header:c(()=>{var e;return[(null==(e=s.value)?void 0:e.picUrl)?(r(),i(l,{key:0,src:s.value.picUrl,width:"100%",height:"364rpx",mode:"aspectFill"},null,8,["src"])):y("",!0)]}),default:c(()=>[g(u,{class:"pt-10rpx px-30rpx h-full w-full bg-white"},{default:c(()=>[g(u,{class:"activity-info"},{default:c(()=>{var e;return[g(u,{class:"mb-16rpx gap-20rpx flex items-center justify-between"},{default:c(()=>{var e;return[g(o,{text:(null==(e=s.value)?void 0:e.name)||""},null,8,["text"]),g(u,{class:"px-16rpx py-8rpx text-28rpx rounded-full bg-blue-50 text-blue-400"},{default:c(()=>[h(" 进行中 ")]),_:1})]}),_:1}),g(m,{data:[{label:"活动地址：",icon:"location",value:null==(e=s.value)?void 0:e.address},{label:"活动时间：",icon:"time",value:a.value}],"label-span":10,"value-span":14},{label:c(({item:e})=>[g(u,{class:"gap-20rpx inline-flex items-center"},{default:c(()=>[g(u,{class:"w-36rpx h-36rpx inline-flex items-center justify-center"},{default:c(()=>[g(d,{name:e.icon,size:"location"===e.icon?"36rpx":"28rpx"},null,8,["name","size"])]),_:2},1024),g(v,{text:e.label},null,8,["text"])]),_:2},1024)]),_:1},8,["data"]),g(u,{class:"sign-step mt-60rpx"},{default:c(()=>[g(u,{class:"inline-flex"},{default:c(()=>[g(j,{type:"long"},{default:c(()=>[g(x,{title:"签到步骤"})]),_:1})]),_:1}),g(I,{class:"mt-40rpx",active:2,vertical:"",dot:""},{default:c(()=>[g(C,{title:"获取当前位置"}),g(C,{title:"提交签到"})]),_:1})]),_:1}),g(u,{class:"current-location"},{default:c(()=>[g(u,{class:"inline-flex"},{default:c(()=>[g(j,{type:"long"},{default:c(()=>[g(x,{title:"当前位置"})]),_:1})]),_:1}),g(u,{class:"location-card mt-40rpx py-30rpx px-20rpx flex items-center justify-between rounded-lg bg-gray-100"},{default:c(()=>[g(u,null,{default:c(()=>[g(u,{class:"gap-300rpx flex items-center"},{default:c(()=>[g(u,null,{default:c(()=>[g(d,{name:"location",size:"20",color:"#60a5fa "}),g(N,{class:"ml-2 font-medium"},{default:c(()=>[h("位置：")]),_:1})]),_:1}),g(z,{type:"text",class:"text-blue-400",onClick:f},{default:c(()=>[g(d,{name:"refresh1"}),g(N,{class:"ml-1"},{default:c(()=>[h("重新获取")]),_:1})]),_:1})]),_:1}),g(N,{class:"text-gray-500"},{default:c(()=>[h(k($(p)),1)]),_:1})]),_:1})]),_:1})]),_:1})]}),_:1})]),_:1}),g(u,{class:"py-36rpx px-54rpx z-999 fixed bottom-0 left-0 right-0 bg-white"},{default:c(()=>[g(z,{class:"w-full",onClick:_},{default:c(()=>[h(" 提交签到 ")]),_:1})]),_:1})]),_:1})]),_:1})}}}),[["__scopeId","data-v-93ca47f5"]]);export{Q as default};
