import{d as e,aR as a,aS as l,H as t,B as s,a6 as o,c as r,w as n,r as i,a as u,b as d,A as c,e as m,a7 as p,D as f,y as _,aT as x,C as v,_ as b}from"./index-BAYT1_GE.js";import{_ as g}from"./BannerView.vue_vue_type_script_setup_true_lang.CfEUUJf5.js";import{_ as y}from"./PyText.vue_vue_type_script_setup_true_lang.na7fmCI6.js";import{_ as w}from"./wd-form.rXyRT9bU.js";import{l as h}from"./pythroot-banner.WDKHhXnh.js";import{_ as V}from"./SmsCodeBtn.vue_vue_type_script_setup_true_lang.DhLqWvJq.js";import"./wd-text.DuK9VuY3.js";const j=b(e({__name:"index",setup(e){const b=a(),j=l("tenant_id",""),T=t(),k=s(),I=o({code:"",mobile:""}),z=s(!1);async function C(){return await k.value.validate()}async function P(){var e,a;if(z.value)return;const{valid:l}=await k.value.validate();if(l)try{z.value=!0;const l=await x.general.smsLogin({data:{...I,templateIdList:[1,2]}});if((null==(e=null==l?void 0:l.data)?void 0:e.accessToken)&&(null==(a=null==l?void 0:l.data)?void 0:a.tenantId)){const{accessToken:e,tenantId:a}=l.data;b.value=e,j.value=a,v({icon:"success",title:"登录成功",success(){setTimeout(()=>{T.replaceAll({name:"merchantProfile"})},1e3)}})}else v({icon:"error",title:(null==l?void 0:l.msg)||"登录失败"})}finally{z.value=!1}}const q=/^\d{11}$/;function B(e){return!(I.mobile&&q.test(I.mobile)&&!e)}return(e,a)=>{const l=p,t=f,s=w,o=m,x=y,v=g,b=i("layout-default-uni");return u(),r(b,null,{default:n(()=>[d(v,{fixed:!1,"custom-class":"bg-white login-page","banner-src":c(h),"banner-height":"364rpx"},{default:n(()=>[d(o,{class:"py-60rpx px-56rpx flex h-full flex-grow flex-col"},{default:n(()=>[d(s,{ref_key:"form",ref:k,"custom-class":"gap-16rpx flex flex-col",model:c(I)},{default:n(()=>[d(l,{modelValue:c(I).mobile,"onUpdate:modelValue":a[0]||(a[0]=e=>c(I).mobile=e),prop:"mobile",rules:[{required:!0,message:"请输入手机号"},{required:!1,pattern:q,message:"手机号格式不正确"}],"custom-class":"rounded-10rpx px-28rpx","no-border":"",type:"digit","input-mode":"numeric",placeholder:"请输入手机号"},null,8,["modelValue","rules"]),d(l,{modelValue:c(I).code,"onUpdate:modelValue":a[1]||(a[1]=e=>c(I).code=e),prop:"code",rules:[{required:!1,validator:B,message:"请输入验证码"}],"custom-class":"rounded-10rpx px-28rpx","no-border":"",type:"text","input-mode":"text",placeholder:"请输入验证码"},{suffix:n(()=>[d(V,{mobile:c(I).mobile,"is-admin":!0,onValidate:C},null,8,["mobile"])]),_:1},8,["modelValue","rules"]),d(t,{type:"primary",block:"",size:"large",round:!1,disabled:c(z),onClick:P},{default:n(()=>[_(" 登录 ")]),_:1},8,["disabled"])]),_:1},8,["model"]),d(o,{class:"flex-grow"}),d(o,{class:"flex flex-col items-center"},{default:n(()=>[d(x,{text:"浦江数链提供技术支持",color:"#999",size:"24rpx"}),d(x,{text:"沪ICP备2023032312号-1",color:"#999",size:"24rpx"})]),_:1})]),_:1})]),_:1},8,["banner-src"])]),_:1})}}}),[["__scopeId","data-v-e21bbca7"]]);export{j as default};
