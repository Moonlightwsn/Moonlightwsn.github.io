import{d as e,H as a,c as t,w as n,r,a as s,b as i,e as o,S as c,P as l,C as d}from"./index-BAYT1_GE.js";import{_ as u}from"./wd-card.C5R0oOJ3.js";import{_ as m}from"./wd-text.DuK9VuY3.js";import{u as p}from"./useLocation.UBtuxGQc.js";import{u as f}from"./usePageOptions.aM0KPUm6.js";const w=e({__name:"qrcode",setup(e){const w=a(),{longitude:x,latitude:h,update:v}=p();return f(e=>{const{machineCode:a}=e||{};!async function(e){try{if(!e)throw new Error("没有识别到二维码");const a=await l.app.queryQRCodeInfo({params:{machineCode:e,manualCode:""}}),{entityId:t,type:n}=a.data||{};if(1!==Number(n))throw new Error("不合法的二维码");await v(),await l.app.createActivityAttendanceWithQRCode({data:{machineCode:e,locationLongitude:null===x.value?void 0:String(x.value),locationLatitude:null===h.value?void 0:String(h.value)}});const r=t;d({icon:"success",title:"参加活动成功"}),r?w.replace({name:"activityDetail",params:{id:String(r)}}):w.replace({name:"index"})}catch(a){d({icon:"error",title:(null==a?void 0:a.message)||"不合法的二维码"}),w.replace({name:"index"})}}(a)}),(e,a)=>{const l=c,d=m,p=o,f=u,w=r("layout-default-uni");return s(),t(w,null,{default:n(()=>[i(p,{class:"flex h-screen w-screen flex-col items-center justify-center overflow-hidden p-10"},{default:n(()=>[i(f,{class:"!m-0 !p-0"},{default:n(()=>[i(p,{class:"h-560rpx w-560rpx flex flex-col items-center justify-center gap-10"},{default:n(()=>[i(l,{size:"120rpx"}),i(d,{text:"参加活动中..."})]),_:1})]),_:1})]),_:1})]),_:1})}}});export{w as default};
