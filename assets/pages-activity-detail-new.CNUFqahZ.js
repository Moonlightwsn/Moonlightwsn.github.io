import{g as e,I as t,J as a,m as l,K as s,f as r,d as o,B as n,p as u,L as i,q as c,M as d,N as p,O as v,c as m,a as A,e as f,n as h,h as g,w as x,b as y,j as w,Q as b,S as _,R as B,_ as k,H as U,T as S,U as j,r as C,C as R,A as I,t as V,V as T,W as N,X as Q,Y as E,D as P,y as z,z as D,Z as O,P as H,$ as M,a0 as J,a1 as K,a2 as F,a3 as W}from"./index-a6TtsOgc.js";import{_ as Z}from"./BannerView.vue_vue_type_script_setup_true_lang.BEJtDK2a.js";import{u as L}from"./useTouch.CRYpSxCS.js";import{_ as Y}from"./QrScannerView.C7Fi0T6g.js";import{_ as X,a as G}from"./HtmlCard.vue_vue_type_script_setup_true_lang.DvF9y1LH.js";import{_ as q}from"./GradientText.vue_vue_type_script_setup_true_lang.BaEWYYVF.js";import{_ as $}from"./Avatar.vue_vue_type_script_setup_true_lang.ex313Ryk.js";import{_ as ee}from"./PyText.vue_vue_type_script_setup_true_lang.C4vd1DLX.js";import{_ as te}from"./PyTitle.CL2zNIOD.js";import{G as ae}from"./gift.CnwWG0IK.js";import{T as le}from"./ticket.Bwxup39T.js";import{u as se}from"./usePageOptions.B-ChW6vP.js";import{u as re}from"./useRouteState.CRSHlu1-.js";import{u as oe}from"./useLocation.D1iCblDR.js";import{f as ne}from"./index.CVFvtcrF.js";import"./wd-text.O2Z1f8vu.js";import"./_commonjsHelpers.lGe4XDVY.js";const ue=k(o({name:"wd-floating-panel",options:{virtualHost:!0,addGlobalClass:!0,styleIsolation:"shared"},props:{...e,height:r(0),anchors:s(),safeAreaInsetBottom:l(!1),showScrollbar:t,duration:a(300),contentDraggable:t},emits:["update:height","height-change"],setup(e,{emit:t}){const a=L(),l=e,s=t,r=n(l.height);let o;const k=n(0),U=n(!1),S=u(()=>({min:l.anchors[0]?l.anchors[0]:100,max:l.anchors[l.anchors.length-1]?l.anchors[l.anchors.length-1]:Math.round(.6*k.value)})),j=u(()=>l.anchors.length>=2?l.anchors:[S.value.min,S.value.max]),C=u(()=>{const e={height:i(S.value.max),transform:`translateY(calc(100% + ${i(-r.value)}))`,transition:U.value?"none":`transform ${l.duration}ms cubic-bezier(0.18, 0.89, 0.32, 1.28)`};return`${c(e)}${l.customStyle}`}),R=e=>{r.value=e,s("update:height",e)},I=e=>{a.touchStart(e),U.value=!0,o=-r.value},V=e=>{if("content"==e.currentTarget.dataset.id&&!l.contentDraggable)return;a.touchMove(e);const t=a.deltaY.value+o;R(-N(t))},T=()=>{U.value=!1,R(B(j.value,r.value)),r.value!==-o&&s("height-change",{height:r.value})},N=e=>{const t=Math.abs(e),{min:a,max:l}=S.value;return t>l?-(l+.2*(t-l)):t<a?-(a-.2*(a-t)):e};return d(()=>l.height,e=>{r.value=e}),d(S,()=>{R(B(j.value,r.value))},{immediate:!0}),p(()=>{const{windowHeight:e}=v();k.value=e}),(e,t)=>{const a=f,l=_;return A(),m(a,{class:g(`wd-floating-panel ${e.customClass} ${e.safeAreaInsetBottom?"is-safe":""}`),style:h(C.value),onTouchstartPassive:I,onTouchmovePassive:V,onTouchend:T,onTouchcancel:T},{default:x(()=>[y(a,{class:g("wd-floating-panel__header")},{default:x(()=>[y(a,{class:g("wd-floating-panel__header-bar")})]),_:1}),y(l,{class:g("wd-floating-panel__content"),"data-id":"content","show-scrollbar":e.showScrollbar,"scroll-y":"",onTouchmove:b(V,["stop","prevent"])},{default:x(()=>[w(e.$slots,"default",{},void 0,!0)]),_:3},8,["show-scrollbar"])]),_:3},8,["class","style"])}}}),[["__scopeId","data-v-b3b199e2"]]),ie="YYYY年MM月DD日 hh时mm分",ce=o({__name:"detail-new",setup(e){const t=U(),a=re(),{longitude:l,latitude:s,update:r}=oe(),o=u(()=>{var e,t;return[{key:"pythroot",icon:le,title:"可领数根",bg:"#29A2FB1A",products:(null==(e=c.value)?void 0:e.issueProduct)||[]},{key:"profit",icon:ae,title:"可领权益",bg:"#FF6A001A",products:(null==(t=c.value)?void 0:t.issueVoucher)||[]}]}),i=n(),c=n(null),d=n(!1),p=n(),g=u(()=>{var e;if("boolean"!=typeof p.value)return"";if(p.value)return"已参与";const t=Number(null==(e=c.value)?void 0:e.type);return 0===t?"线下扫码":1===t?"签到参与":2===t?"立即领取":""});async function w(e){const t=M();if(!t.value||"preview"===i.value)return void(p.value=!1);const a=await H.app.checkActivityAttended({params:{activityId:e},meta:{ignore:{unauthorized:!0,showToast:!0}}}).catch(e=>(401!==(null==e?void 0:e.code)&&403!==(null==e?void 0:e.code)||(t.value=""),{code:-1,data:!1}));return p.value=0===(null==a?void 0:a.code)&&a.data||!1,p.value}function b(e,l){const s=a.depositRouteState(l);t.push({name:"activityResult",params:{id:String(e),pageUUID:s}})}async function _(){var e;if("preview"===i.value)return;if(!(null==(e=c.value)?void 0:e.id))return void R({icon:"error",title:"活动数据未加载完成，请稍后重试"});const{id:a,type:l}=c.value;if(M().value)switch(l){case 0:"number"==typeof k.value&&(L.value=k.value);break;case 1:t.push({name:"activityAttendance",params:{id:String(a)}});break;case 2:{d.value=!0;const e=await H.app.createActivityAttendance({data:{activityId:a}}).finally(()=>d.value=!1);(null==e?void 0:e.data)&&(R({icon:"success",title:"签到成功"}),p.value=!0,b(a,e.data));break}}else J({title:"用户未登录",content:"请登录后再来参加活动！",cancelText:"继续浏览",confirmText:"去登录",success(e){(null==e?void 0:e.confirm)&&(K(t.route.value),F())}})}function B(e){var a;const o=M();!function(){const e=Date.now(),{endTime:t}=c.value||{},a=Number(t);if(Number.isNaN(a)||!(e<a))throw new Error("活动已过期");if(p.value)throw new Error("您已参加过该活动")}(),J({title:"参加活动",content:`确认要参加${(null==(a=c.value)?void 0:a.name)||""}活动么？`,confirmText:o.value?"确认参加":"登录并参加",cancelText:"放弃",success({confirm:a}){a&&(o.value?async function(e){var t;const a=null==(t=null==c?void 0:c.value)?void 0:t.id;if(e&&a)try{await r({toast:!0,forceUpdate:!0});const t=await H.app.createActivityAttendanceWithQRCode({data:{machineCode:e,locationLongitude:null===l.value?void 0:String(l.value),locationLatitude:null===s.value?void 0:String(s.value)}});(null==t?void 0:t.data)&&(R({icon:"success",title:"参加活动成功"}),b(a,t.data))}catch(o){R({icon:"error",title:o.message||"未知错误"})}}(e):K(t.route.value))}})}se(async e=>{if(null==e?void 0:e.id)try{let t=function(){"scanQrcode"===i.value&&s&&B(s)};const{id:a,scene:l,machineCode:s}=e;i.value=l||void 0;const r=Number.parseInt(a,10);if(Number.isNaN(r))return void R({icon:"error",title:"无效的活动ID"});await async function(e){const t=await H.app.getActivity({params:{id:e}});return(null==t?void 0:t.data)?c.value=t.data:(c.value=null,R({icon:"error",title:"没有获取到权益详情"})),c.value}(r),await w(r),setTimeout(()=>{t()},0)}catch(t){R({icon:"error",title:t.message||"未知错误"})}}),S(()=>{var e;(null==(e=c.value)?void 0:e.id)&&w(c.value.id)});const k=n(),L=n(0),ce=n([0]);function de(){L.value=0}async function pe(e=""){try{const{path:a,queryParams:l}=W(e);if("/pages/checkout/qrcode"!==a)throw new Error("不合法的二维码");await async function(e){var a;if(!e)throw new Error("没有识别到活动");const l=await H.app.queryQRCodeInfo({params:{machineCode:e,manualCode:""}}),{entityId:s,type:r}=l.data||{};if(!s||1!==Number(r))throw new Error("不合法的二维码");de(),s===(null==(a=c.value)?void 0:a.id)?B(e):t.push({name:"activityDetail",params:{id:String(s),scene:"scanQrcode",machineCode:e}})}(null==l?void 0:l.machineCode)}catch(a){de(),R({icon:"error",title:a.message||"不合法的二维码"})}}return j(()=>{const e=v().windowHeight;k.value=.9*e,ce.value=[0,k.value]}),(e,a)=>{const l=te,s=f,r=X,n=ee,u=$,v=q,w=G,b=P,B=Y,U=ue,S=Z,j=C("layout-default-uni");return A(),m(j,null,{default:x(()=>{var e;return[y(S,{"custom-class":"h-screen bg-#f5f5f5 pb-154rpx","banner-class":"rounded-b-100rpx overflow-hidden !left-1/2 !translate-x-[-50%] !w-811rpx ","banner-height":"422rpx","banner-src":null==(e=c.value)?void 0:e.picUrl},{default:x(()=>[y(s,{class:"px-36rpx mt-[-96rpx]"},{default:x(()=>{var e;return[y(s,{class:"min-h-600rpx pt-26rpx px-40rpx pb-64rpx flex w-full flex-col",style:h({backgroundImage:`url(${I("/assets/activity-detail-card-bg-Xors4_7S.png")})`,backgroundSize:"100% 100%"})},{default:x(()=>{var e;return[y(l,{"custom-class":"!font-600",color:"#37445D","line-height":"normal",size:"34rpx",text:null==(e=c.value)?void 0:e.name},null,8,["text"]),y(s,{class:"my-18rpx bg-#E2E2E2 h-2rpx w-full scale-y-50"}),y(s,{class:"gap-12rpx flex flex-col"},{default:x(()=>[y(s,{class:"gap-14rpx flex items-start"},{default:x(()=>{var e;return[y(s,{class:"w-168rpx flex flex-shrink-0 items-center"},{default:x(()=>[y(r,{src:I("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABYAAAAWCAYAAADEtGw7AAAACXBIWXMAABYlAAAWJQFJUiTwAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAALoSURBVHgBrZXPTxpREMdndh+JNWnC3ZiCPdfQxCrpRQiY9Fa8tdUWuPUmvfUm3nor3LzJD2N6pLcmgqxJD4gmgn+A7MHeadJYE2GnMyj08VObdJIlvHkzn533nXmAcA8LBCLuK5hyy/cpuGpaVqF5Vw5O2lwIryVMwJccFujfoZrjOOnjg73MP4H9gVceMl1l3vUQwCEHFZBhHSSgj30R9i3zwsb2dbBifbHvBAvUUa5TRGwiOfFKcdca+fIXMQ+1nTIRuQnbweP9vdpYcK9SA+HBtfHUsjITtezCwSF40Db74g090DFVUo6PphHUg6R5z1be+OTR4yvfMrbEEoL7UrUS+l4fGJAbhZCRhK5riRt4qR42DDJP5VkKvW3oL5BYAyjNyRuBQMw9BPaH1wOsi9uBdrrrWwy9jnDIZ/5qsZar3MCgyIRklkU2rSRLcn+plm8I7PCJudtNvQmI5gZ/1qrF/Gq1tFuQRor2skem6h1d/JJrAg2DOyCCwWZ5CZyvukO0l9EjRE9fLtBPHsVhKXijKU3o52KDD74Mg0boQSJ7IPaRMLor9ReMIoF7gbU+uZ1dRMgSwc5ieH3TaLWyHaZysTw8OUqlurnSH5YC2jeM/oqnWqrW0Ykg0vVV9vMZfuEWP0kGNjoPYAwdiOuTw2Mc4yrsE+0yGbp2MjasXVTveKWYS6IyvTIVDkJ8umV4Kwf5TK9ajuVbGuWTZXVhlL7gqlO/XU6UK9vhZbAHv6nOhhFGSu1ItdPXRkr3m/rCtmtXs3NP6qxucmZuHn6cnx3CBGNtNzk2ZhDFv5dztbFgsYvzM3t2zie/IclZr8++aNTro6ByI1nJT6z51lEpvz24b45KujivWzOP573j4P7QWhTQ2OaxS1dLuY+jGCPBYixDoQvXZelUylBucrZazL0flz/xH6QDCq2nuDkbBJTEm5uVkEqPSrnEpLw7wWL+8Lskgzdvlx+OivkU/C97vhLzyQ27b/wfWV5Kjq47K7QAAAAASUVORK5CYII=")},null,8,["src"]),y(n,{"custom-class":"flex-shrink-0 ml-10rpx",text:"活动地址：",color:"#37445D",size:"27rpx"})]),_:1}),y(n,{"custom-class":"font-300",text:(null==(e=c.value)?void 0:e.address)||"-"},null,8,["text"])]}),_:1}),y(s,{class:"gap-14rpx flex items-start"},{default:x(()=>[y(s,{class:"w-168rpx flex flex-shrink-0 items-center"},{default:x(()=>[y(r,{src:I("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAI4SURBVHgBpVQ9T9tgEL577XagDNnbKh97iysVyFarmLkZK5SQ8A/arVucrVvpL2iUIGZ3TijO1NB0aOieGgnmgtSPAezj7oVICbHBgmdIfK/vHt9799whJOC5U7YNoiooZRNBBgEyAPSDAAKKos+DL9vNuDiMJ8JP/CbH5gER+fwcaGcSUrTZXgCCIKKwcZV4irDolOsE6HIWPQXk9rtbPsRgcXXNUmS4/PgqAtgcdNtvZ5yEbNmp0JKz7kJKFNlXYhadyofxmaG/+HKthqg2ObvGt27LTUt4OBr6jwsW8jXfPSo8OTka/ezrKy+vVH6BQtjrtPJXg2y7lPljzlvfE66v453KLpfJmjsz8mpppVySBoQUbcQ5/zPmbQNwF64BAjVEBf/N05pimwkxSMqAFGbgBlw2zydQtuICZFkaQ7grmINltSAZ5kWwcFcgBVI6M62/yGPSjjB8NuhszyQihL+RMJtE9ODU8P7eC2PO7wdTB4Q5/g1MHqEeIVTZiO2y7zeP+a8JNwHhBV9hKE3xpOUyw3BLFO3XOWa0WMqe0i1n2bDW6nBLRIbpCke/024qne2FqO3JmUydHe8ARKyKuMXWs3w42g/GM/mw8BSORvu9tGSynbghH/e67fc6uWmHdV5dVJddFyJtJE2P3pkAdb0bhWyn9Wb8bmbBFlcrNZJ6EuWEGGSkkA60M1FWNjif59jn2OBSfd3Z8ibjERKgl4aCEkZoEV7olOt0ojc4gDcXmv6lpKZwDuAa6iTxZNykAAAAAElFTkSuQmCC")},null,8,["src"]),y(n,{"custom-class":"flex-shrink-0 ml-14rpx",text:"活动时间：",color:"#37445D",size:"27rpx"})]),_:1}),y(s,{class:"flex flex-grow flex-col"},{default:x(()=>{var e,t;return[y(n,{"custom-class":"font-300",text:I(ne)(null==(e=c.value)?void 0:e.startTime,ie)},null,8,["text"]),y(n,{"custom-class":"font-300",text:I(ne)(null==(t=c.value)?void 0:t.endTime,ie)},null,8,["text"])]}),_:1})]),_:1}),y(s,{class:"gap-14rpx flex items-center"},{default:x(()=>{var e,t;return[y(s,{class:"w-168rpx flex flex-shrink-0 items-center"},{default:x(()=>[y(r,{src:I("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAwAAAAMCAYAAABWdVznAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAD1SURBVHgBlVBLTgJBEH1VRYzs5gh6AsaFsrQx4163qJEjeAVvoDdASFzrGhJ76WfhcAO9waxg0zNFQxhoPsmEt+hU9XuVl/eAChhzFYV7rRyayc0DIPeAZlD8Kek/AecTpSNPH5c6nj2nF+2OksR1x62vYb9VcP7sCVt3tWtPj4zpROsOIiDNU2t72Wz9GbymgbMdH6jx49vSQUQslBvYAQKllMOs9gXOkttfgr5s5vCSBhPePwf97lpofzpSleh72DuZ57psx6IcHTp5srabbbVEqmlRuCUR5gjB5SBOLRPH2AfN5O6jSsObH2HnlQe+pUdUYAoqSVReBzLi1AAAAABJRU5ErkJggg==")},null,8,["src"]),y(n,{"custom-class":"flex-shrink-0 ml-10rpx",text:"主办方：",color:"#37445D",size:"27rpx"})]),_:1}),(null==(e=c.value)?void 0:e.picUrl)?(A(),m(u,{key:0,"custom-class":"flex-shrink-0",src:c.value.picUrl,border:!0,size:"72rpx"},null,8,["src"])):V("",!0),y(n,{"custom-class":"font-300",lines:2,text:null==(t=c.value)?void 0:t.sponsorName,color:"#000000",size:"27rpx"},null,8,["text"])]}),_:1})]),_:1}),y(s,{class:"mt-70rpx gap-16rpx flex flex-col"},{default:x(()=>[(A(!0),T(N,null,Q(I(o),e=>(A(),m(s,{key:e.key},{default:x(()=>[y(s,{class:"gap-24rpx mb-28rpx flex items-center"},{default:x(()=>[y(r,{src:e.icon,width:"36rpx",height:"36rpx"},null,8,["src"]),y(l,{text:e.title,color:"#37445D",size:"27rpx","line-height":"normal"},null,8,["text"])]),_:2},1024),y(s,{class:"flex flex-row flex-wrap"},{default:x(()=>[(A(!0),T(N,null,Q(e.products,a=>(A(),m(s,{key:a.id,class:"max-w-1/2 mb-16rpx basis-1/2"},{default:x(()=>[y(s,{class:"pr-24rpx pl-80rpx py-2rpx relative inline-flex max-w-full rounded-full",style:h({background:e.bg}),onClick:l=>function(e,a){if("preview"!==i.value)switch(a){case"profit":t.push({name:"profitDetail",params:{pId:String(e),type:"product"}});break;case"pythroot":t.push({name:"pythrootDetail",params:{pId:String(e),type:"product"}})}}(a.productId,e.key)},{default:x(()=>[a.picUrl?(A(),m(u,{key:0,"custom-class":"!absolute top-1/2 left-0 translate-y-[-50%] bg-#f5f5f5",src:a.picUrl,border:!0,size:"60rpx"},null,8,["src"])):V("",!0),y(v,{"custom-class":"min-w-120rpx  leading-38rpx text-center font-500 text-24rpx truncate",text:a.name,from:"pythroot"===e.key?"#09DAFF":void 0,to:"pythroot"===e.key?"#29A2FB":void 0},null,8,["text","from","to"])]),_:2},1032,["style","onClick"])]),_:2},1024))),128))]),_:2},1024)]),_:2},1024))),128))]),_:1})]}),_:1},8,["style"]),y(w,{"custom-class":"mx-8rpx mt-28rpx",title:"详细介绍","dompurify-html":(null==(e=c.value)?void 0:e.description)||"<p>暂无详细介绍</p>"},null,8,["dompurify-html"])]}),_:1}),y(s,{class:"py-36rpx px-54rpx z-999 fixed bottom-0 left-0 right-0"},{default:x(()=>[E(y(b,{class:"w-full !opacity-100 shadow-[2rpx_2rpx_2rpx_0_rgba(0,0,0,0.15)]",onClick:_,block:"",loading:d.value,disabled:p.value,type:p.value?"info":"primary"},{default:x(()=>[z(D(I(g)),1)]),_:1},8,["loading","disabled","type"]),[[O,Boolean(I(g))]])]),_:1}),y(U,{"custom-class":"!z-1000 bg-black rounded-none",height:L.value,"onUpdate:height":a[0]||(a[0]=e=>L.value=e),anchors:ce.value},{default:x(()=>["number"==typeof k.value&&L.value>100?(A(),m(B,{key:0,onResult:pe})):V("",!0)]),_:1},8,["height","anchors"])]),_:1},8,["banner-src"])]}),_:1})}}});export{ce as default};
