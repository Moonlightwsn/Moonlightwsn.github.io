import{d as e,B as a,p as t,c as s,a as l,D as n,A as i,w as o,y as c,t as d,x as r,z as m,bF as u,a0 as v,aS as p,C as b}from"./index-a6TtsOgc.js";const f=e({name:"SmsCodeBtn",__name:"SmsCodeBtn",props:{isAdmin:{type:Boolean},mobile:{}},emits:["validate","register"],setup(e,{emit:f}){const y=e,h=f,C=a(0),S=a(!1),g=t(()=>S.value||C.value>0),w=/^\d{11}$/;let _;function x(){clearInterval(_),C.value=0}async function B(){if(!g.value)if(w.test(y.mobile))try{S.value=!0,y.isAdmin?await u.general.checkOutSendLoginSmsCode({data:{mobile:y.mobile,scene:21}}).catch(e=>{throw 1002000007===e.code&&v({title:"提示",content:"用户还未注册，请联系管理员开通账户？"}),e}):await p.app.sendSmsCode({data:{mobile:y.mobile,scene:1}}).catch(e=>{throw 1004001001===e.code&&v({title:"提示",content:"用户还未注册，是否前往注册？",success({confirm:e}){e&&h("register")}}),e}),x(),C.value=60,_=setInterval(()=>{C.value-=1},996),b({icon:"success",title:"验证码已发送"})}catch(e){x(),console.log(e)}finally{S.value=!1}else h("validate")}return(e,a)=>{const t=r,u=n;return l(),s(u,{type:"text",disabled:i(g),onClick:B},{default:o(()=>[c(" 获取验证码 "),i(C)>0?(l(),s(t,{key:0},{default:o(()=>[c("("+m(i(C))+")",1)]),_:1})):d("",!0)]),_:1},8,["disabled"])}}});export{f as _};
