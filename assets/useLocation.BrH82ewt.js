import{Y as t,Z as e,p as a,I as i,D as s,J as o}from"./index-DHS_FSaD.js";const r=t("location",{state:()=>({loading:!1,hasFirstErrorToast:!1,longitude:null,latitude:null,lastUpdateTimestamp:0}),actions:{async updateCurrentLocation({forceUpdate:t=!1}={}){if(this.latitude&&this.longitude){const e=Date.now();if(!t&&e-this.lastUpdateTimestamp<=6e4)return{latitude:this.latitude,longitude:this.longitude}}return new Promise((t,a)=>{this.loading=!0,e({type:"wgs84",isHighAccuracy:!0,highAccuracyExpireTime:8e3,success:e=>{if(e){const{latitude:a,longitude:i}=e;this.latitude=a,this.longitude=i,this.lastUpdateTimestamp=Date.now(),t(e)}else t(void 0)},fail:t=>{a(t)},complete:()=>{this.loading=!1}}),setTimeout(()=>{a(new Error("获取定位超时"))},1e4)})},setHasErrorToastFlag(){this.hasFirstErrorToast=!0}}});function n(){const t=r();return{loading:a(()=>t.loading),hasFirstErrorToast:a(()=>t.hasFirstErrorToast),latitude:a(()=>t.latitude),longitude:a(()=>t.longitude),update:function({toast:e=!1,forceUpdate:a=!1}={}){return e&&i({title:"正在获取定位..."}),t.updateCurrentLocation({forceUpdate:a}).catch(t=>{console.log(t),e&&s({icon:"error",title:t.message||"无法获取定位"})}).finally(()=>{e&&o()})},firstErrorToast:function(){t.setHasErrorToastFlag()}}}export{n as u};
