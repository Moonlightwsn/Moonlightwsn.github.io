import{m as e,f as t,g as s,d as a,u as l,c as i,a as r,e as n,n as o,h as u,w as c,j as d,_ as p,k as f,l as _,p as v,q as m,s as x,t as y,b as g,v as w,x as b,y as h,z as $,A as k,H as j,B as S,r as C,C as I,P as D,D as N,E as z,F as B,G as T}from"./index-a6TtsOgc.js";import{_ as A}from"./BannerView.vue_vue_type_script_setup_true_lang.BEJtDK2a.js";import{_ as F,a as U}from"./wd-tab.ButUF3oK.js";import{_ as G}from"./Descriptions.vue_vue_type_script_setup_true_lang.CrXBZlhN.js";import{_ as H}from"./PyText.vue_vue_type_script_setup_true_lang.C4vd1DLX.js";import{_ as P}from"./PyTitle.CL2zNIOD.js";import{u as Y}from"./useRouteState.CRSHlu1-.js";import{u as L}from"./usePageOptions.B-ChW6vP.js";import{u as R}from"./useLocation.D1iCblDR.js";import{f as E}from"./index.CVFvtcrF.js";import"./useTouch.CRYpSxCS.js";import"./wd-col.B73-JYnr.js";import"./wd-text.O2Z1f8vu.js";import"./_commonjsHelpers.lGe4XDVY.js";const M={...s,active:t(0),vertical:e(!1),dot:e(!1),space:String,alignCenter:e(!1)},q=Symbol("wd-steps"),O=p(a({name:"wd-steps",options:{addGlobalClass:!0,virtualHost:!0,styleIsolation:"shared"},props:M,setup(e){const t=e,{linkChildren:s}=l(q);return s({props:t}),(e,t)=>{const s=n;return r(),i(s,{class:u(`wd-steps ${e.customClass} ${e.vertical?"is-vertical":""}`),style:o(e.customStyle)},{default:c(()=>[d(e.$slots,"default",{},void 0,!0)]),_:3},8,["class","style"])}}}),[["__scopeId","data-v-fdf5188c"]]),V=p(a({name:"wd-step",options:{addGlobalClass:!0,virtualHost:!0,styleIsolation:"shared"},props:{...s,title:String,description:String,icon:String,status:String},setup(e){const t=e,{parent:s,index:a}=f(q),{translate:l}=_("steps"),p=v(()=>function(e){if(t.status)return t.status;if(s){const{active:t}=s.props;return Number(t)>e?"finished":Number(t)===e?"process":"wait"}return"wait"}(a.value)),j=v(()=>function(e){if(t.title)return t.title;switch(e){case"finished":return l("finished");case"error":return l("failed");case"process":return l("process");default:return l("wait")}}(p.value)),S=v(()=>{const e={};if(s){const{vertical:t,space:a}=s.props;t?x(a)&&(e.height=a):e.width=a||100/s.children.length+"%"}return`${m(e)}${t.customStyle}`}),C=v(()=>{if(x(s)){const{vertical:e,alignCenter:t}=s.props;return Boolean(!e&&t)}return!1}),I=v(()=>!!x(s)&&Boolean(s.props.vertical)),D=v(()=>!!x(s)&&Boolean(s.props.dot)),N=v(()=>x(s)?Number(s.children.length):0);return(e,t)=>{const s=n,l=b;return p.value?(r(),i(s,{key:0,class:u(`wd-step ${e.customClass} ${p.value?"is-"+p.value:""} ${C.value?"is-center":""}  ${I.value?"is-vertical":""}`),style:o(S.value)},{default:c(()=>[g(s,{class:u("wd-step__header  "+(D.value?"is-dot":""))},{default:c(()=>[g(s,{class:u("wd-step__icon  "+(D.value?"is-dot":e.icon||e.$slots.icon?"is-icon":"is-text"))},{default:c(()=>[D.value?(r(),i(s,{key:0,class:"wd-step__dot"})):e.$slots.icon?d(e.$slots,"icon",{key:1},void 0,!0):e.icon?(r(),i(w,{key:2,"custom-class":"wd-step__icon-inner",name:e.icon},null,8,["name"])):(r(),i(s,{key:3,class:"wd-step__icon-outer"},{default:c(()=>["finished"===p.value?(r(),i(w,{key:0,name:"check-bold"})):"error"===p.value?(r(),i(w,{key:1,name:"close-bold"})):(r(),i(l,{key:2},{default:c(()=>[h($(k(a)+1),1)]),_:1}))]),_:1}))]),_:3},8,["class"]),k(a)<N.value-1?(r(),i(s,{key:0,class:"wd-step__line"})):y("",!0)]),_:3},8,["class"]),g(s,{class:"wd-step__content"},{default:c(()=>[g(s,{class:u("wd-step__title "+(e.$slots.description||e.description?"is-description":""))},{default:c(()=>[e.$slots.title?d(e.$slots,"title",{key:0},void 0,!0):(r(),i(l,{key:1},{default:c(()=>[h($(j.value),1)]),_:1}))]),_:3},8,["class"]),e.$slots.description||e.description?(r(),i(s,{key:0,class:"wd-step__description"},{default:c(()=>[e.$slots.description?d(e.$slots,"description",{key:0},void 0,!0):(r(),i(l,{key:1},{default:c(()=>[h($(e.description),1)]),_:1}))]),_:3})):y("",!0)]),_:3})]),_:3},8,["class","style"])):y("",!0)}}}),[["__scopeId","data-v-b36f9026"]]),J="YYYY年MM月DD日",K=p(a({__name:"attendance",setup(e){const t=j(),s=Y(),a=S(null),l=S("");L(async e=>{if(null==e?void 0:e.id)try{const{id:t}=e,s=Number.parseInt(t,10);if(Number.isNaN(s))return void I({icon:"error",title:"无效的活动ID"});const i=await D.app.getActivity({params:{id:s}});(null==i?void 0:i.data)?(a.value=i.data,l.value=`${E(a.value.startTime,J)} - ${E(a.value.endTime,J)}`):(a.value=null,I({title:"没有获取到权益详情"}))}catch(t){console.error("获取活动详情失败:",t),I({icon:"error",title:"获取活动详情失败，请稍后重试"})}});const{latitude:o,longitude:u,loading:d,update:p}=R(),f=v(()=>d.value?"正在获取定位...":"number"==typeof o.value&&"number"==typeof u.value?`纬度：${o.value.toFixed(6)}, 经度：${u.value.toFixed(6)}`:"请获取位置信息"),_=(e=!1,t)=>p({toast:e,forceUpdate:t}),m=async()=>{var e;const l=null==(e=null==a?void 0:a.value)?void 0:e.id;if(!l)return void I({icon:"error",title:"获取活动信息失败"});if(await _(!0,!0),null===o.value||null===u.value)return void setTimeout(()=>{I({icon:"error",title:"成功获取位置信息后才可以线上签到"})},2e3);B({title:"签到提交中..."});const i=await D.app.createActivityAttendance({data:{activityId:l,locationLatitude:o.value.toString(),locationLongitude:u.value.toString()}}).finally(()=>{T()});(null==i?void 0:i.data)&&(I({icon:"success",title:"提交签到成功"}),function(e,a){const l=s.depositRouteState(a);t.replace({name:"activityResult",params:{id:String(e),pageUUID:l}})}(l,i.data))};return(e,t)=>{const s=z,o=P,u=n,d=w,p=H,v=G,x=U,j=F,S=V,I=O,D=b,B=N,T=A,Y=C("layout-default-uni");return r(),i(Y,null,{default:c(()=>[g(T,{"custom-class":"pb-154rpx"},{header:c(()=>{var e;return[(null==(e=a.value)?void 0:e.picUrl)?(r(),i(s,{key:0,src:a.value.picUrl,width:"100%",height:"364rpx",mode:"aspectFill"},null,8,["src"])):y("",!0)]}),default:c(()=>[g(u,{class:"pt-10rpx px-30rpx h-full w-full bg-white"},{default:c(()=>[g(u,{class:"activity-info"},{default:c(()=>{var e;return[g(u,{class:"mb-16rpx gap-20rpx flex items-center justify-between"},{default:c(()=>{var e;return[g(o,{text:(null==(e=a.value)?void 0:e.name)||""},null,8,["text"]),g(u,{class:"px-16rpx py-8rpx text-28rpx rounded-full bg-blue-50 text-blue-400"},{default:c(()=>[h(" 进行中 ")]),_:1})]}),_:1}),g(v,{data:[{label:"活动地址：",icon:"location",value:null==(e=a.value)?void 0:e.address},{label:"活动时间：",icon:"time",value:l.value}],"label-span":10,"value-span":14},{label:c(({item:e})=>[g(u,{class:"gap-20rpx inline-flex items-center"},{default:c(()=>[g(u,{class:"w-36rpx h-36rpx inline-flex items-center justify-center"},{default:c(()=>[g(d,{name:e.icon,size:"location"===e.icon?"36rpx":"28rpx"},null,8,["name","size"])]),_:2},1024),g(p,{text:e.label},null,8,["text"])]),_:2},1024)]),_:1},8,["data"]),g(u,{class:"sign-step mt-60rpx"},{default:c(()=>[g(u,{class:"inline-flex"},{default:c(()=>[g(j,{type:"long"},{default:c(()=>[g(x,{title:"签到步骤"})]),_:1})]),_:1}),g(I,{class:"mt-40rpx",active:2,vertical:"",dot:""},{default:c(()=>[g(S,{title:"获取当前位置"}),g(S,{title:"提交签到"})]),_:1})]),_:1}),g(u,{class:"current-location"},{default:c(()=>[g(u,{class:"inline-flex"},{default:c(()=>[g(j,{type:"long"},{default:c(()=>[g(x,{title:"当前位置"})]),_:1})]),_:1}),g(u,{class:"location-card mt-40rpx py-30rpx px-20rpx flex items-center justify-between rounded-lg bg-gray-100"},{default:c(()=>[g(u,null,{default:c(()=>[g(u,{class:"gap-300rpx flex items-center"},{default:c(()=>[g(u,null,{default:c(()=>[g(d,{name:"location",size:"20",color:"#60a5fa "}),g(D,{class:"ml-2 font-medium"},{default:c(()=>[h("位置：")]),_:1})]),_:1}),g(B,{type:"text",class:"text-blue-400",onClick:t[0]||(t[0]=e=>_(!1,!0))},{default:c(()=>[g(d,{name:"refresh1"}),g(D,{class:"ml-1"},{default:c(()=>[h("重新获取")]),_:1})]),_:1})]),_:1}),g(D,{class:"text-gray-500"},{default:c(()=>[h($(k(f)),1)]),_:1})]),_:1})]),_:1})]),_:1})]}),_:1})]),_:1}),g(u,{class:"py-36rpx px-54rpx z-999 fixed bottom-0 left-0 right-0 bg-white"},{default:c(()=>[g(B,{class:"w-full",onClick:m},{default:c(()=>[h(" 提交签到 ")]),_:1})]),_:1})]),_:1})]),_:1})}}}),[["__scopeId","data-v-cacd2ce7"]]);export{K as default};
