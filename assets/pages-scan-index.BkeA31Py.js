import{d as t,H as e,a6 as a,W as s,an as n,ah as r,c as l,w as c,r as o,a as i,b as h,e as u,C as f}from"./index-DaxDs61y.js";import{H as d}from"./html5-qrcode-scanner.BbhmqrVV.js";const m=t({__name:"index",setup(t){const m=e(),p=a({html5Qrcode:null});function g(){d.getCameras().then(t=>{var e;t&&t.length>0?(p.html5Qrcode=new d("scan-reader"),null==(e=p.html5Qrcode)||e.start({facingMode:"environment"},{fps:10,qrbox:{width:250,height:250}},t=>{!function(t=""){const e=t.startsWith("http://")||t.startsWith("https://");if(!e)return f({icon:"error",title:"非法的二维码"}),void m.back();const{path:a,queryParams:s}=function(t){const e=new URL(t).hash.slice(1);let a=e,s={};const n=e.indexOf("?");if(-1!==n){a=e.slice(0,Math.max(0,n));const t=e.slice(Math.max(0,n+1)),r=new URLSearchParams(t);s=Object.fromEntries(r)}return{path:a,queryParams:s}}(t);m.replace({path:a,query:s})}(t)},()=>{})):f({icon:"error",title:"未检测到摄像头"})}).catch(t=>{f({icon:"error",title:t.message||"打开摄像头失败"})})}function x(){var t,e;(null==(t=p.html5Qrcode)?void 0:t.isScanning)&&(null==(e=p.html5Qrcode)||e.stop().then(t=>console.log("已停止扫码",t)).catch(t=>console.log("停止失败",t)))}return s(()=>{g()}),n(()=>{x()}),r(()=>{x()}),(t,e)=>{const a=u,s=o("layout-default-uni");return i(),l(s,null,{default:c(()=>[h(a,{class:"flex h-screen w-screen flex-col bg-black"},{default:c(()=>[h(a,{class:"relative h-full w-full"},{default:c(()=>[h(a,{class:"h-full"},{default:c(()=>[h(a,{id:"scan-reader",class:"left-0 top-1/2 translate-y-[-50%]"})]),_:1})]),_:1})]),_:1})]),_:1})}}});export{m as default};
