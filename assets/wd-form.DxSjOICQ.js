import{d as s,bR as e,bN as a,h as o,bS as r,b4 as t,a4 as p,c as n,a as l,e as c,n as i,j as m,w as u,k as d,v as f,bT as g,bU as h,t as b,b0 as y,bV as k,bC as v,bW as w,_ as x}from"./index-BoOjZWLk.js";const C=x(s({name:"wd-form",options:{addGlobalClass:!0,virtualHost:!0,styleIsolation:"shared"},props:e,setup(s,{expose:e}){const{show:x}=a("wd-form-toast"),C=s,{children:E,linkChildren:O}=o(r);let _=t({});function j(s){s?_[s]="":Object.keys(_).forEach(s=>{_[s]=""})}return O({props:C,errorMessages:_}),p(()=>C.model,()=>{C.resetOnChange&&j()},{immediate:!0,deep:!0}),e({validate:async function(s){const e=[];let a=!0;const o=[],r=function(){const s=w(C.rules),e=E.map(s=>s.prop);return Object.keys(s).forEach(a=>{e.includes(a)||delete s[a]}),E.forEach(e=>{b(e.prop)&&b(e.rules)&&e.rules.length&&(s[e.prop]?s[e.prop]=[...s[e.prop],...e.rules]:s[e.prop]=e.rules)}),s}(),t=h(s)?s:b(s)?[s]:[],p=t.length>0?t.reduce((s,e)=>(r[e]&&(s[e]=r[e]),s),{}):r;for(const n in p){const s=p[n],r=y(C.model,n);if(s&&s.length>0)for(const t of s){if(t.required&&(!b(r)||""===r)){e.push({prop:n,message:t.message}),a=!1;break}if(t.pattern&&!t.pattern.test(r)){e.push({prop:n,message:t.message}),a=!1;break}const{validator:s,...p}=t;if(s){const l=s(r,p);k(l)?o.push(l.then(s=>{"string"==typeof s?(e.push({prop:n,message:s}),a=!1):"boolean"!=typeof s||s||(e.push({prop:n,message:t.message}),a=!1)}).catch(s=>{const o=b(s)?v(s)?s:s.message||t.message:t.message;e.push({prop:n,message:o}),a=!1})):l||(e.push({prop:n,message:t.message}),a=!1)}}}return await Promise.all(o),function(s){const e=E.map(s=>s.prop).filter(Boolean),a=s.filter(s=>s.message&&e.includes(s.prop));a.length&&(a.sort((s,a)=>e.indexOf(s.prop)-e.indexOf(a.prop)),"toast"===C.errorType?x(a[0].message):"message"===C.errorType&&a.forEach(s=>{_[s.prop]=s.message}))}(e),a&&(t.length?t.forEach(j):j()),{valid:a,errors:e}},reset:function(){j()}}),(s,e)=>{const a=c;return l(),n(a,{class:m(`wd-form ${s.customClass}`),style:i(s.customStyle)},{default:u(()=>[d(s.$slots,"default",{},void 0,!0),"toast"===C.errorType?(l(),n(g,{key:0,selector:"wd-form-toast"})):f("",!0)]),_:3},8,["class","style"])}}}),[["__scopeId","data-v-e513a788"]]);export{C as _};
