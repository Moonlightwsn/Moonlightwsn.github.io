import{d as e,B as a,p as t,c as s,a as l,F as n,A as i,w as o,y as c,t as d,x as r,z as m,aU as u,aV as v,$ as p,D as f}from"./index-Bly4hIk5.js";const b=e({name:"SmsCodeBtn",__name:"SmsCodeBtn",props:{isAdmin:{type:Boolean},mobile:{}},emits:["validate","register"],setup(e,{emit:b}){const y=e,h=b,g=a(0),w=a(!1),C=t(()=>w.value||g.value>0),S=/^\d{11}$/;let _;function x(){clearInterval(_),g.value=0}async function B(){if(!C.value)if(S.test(y.mobile))try{w.value=!0,y.isAdmin?await u.general.checkOutSendLoginSmsCode({data:{mobile:y.mobile,scene:21}}).catch(e=>{throw 1002000007===e.code&&v({title:"提示",content:"用户还未注册，请联系管理员开通账户？"}),e}):await p.app.sendSmsCode({data:{mobile:y.mobile,scene:1}}).catch(e=>{throw 1004001001===e.code&&v({title:"提示",content:"用户还未注册，是否前往注册？",success({confirm:e}){e&&h("register")}}),e}),x(),g.value=60,_=setInterval(()=>{g.value-=1},996),f({icon:"success",title:"验证码已发送"})}catch(e){x(),console.log(e)}finally{w.value=!1}else h("validate")}return(e,a)=>{const t=r,u=n;return l(),s(u,{type:"text",disabled:i(C),onClick:B},{default:o(()=>[c(" 获取验证码 "),i(g)>0?(l(),s(t,{key:0},{default:o(()=>[c("("+m(i(g))+")",1)]),_:1})):d("",!0)]),_:1},8,["disabled"])}}});export{b as _};
