import{_ as t}from"./BannerView.vue_vue_type_script_setup_true_lang.BEJtDK2a.js";import{_ as e}from"./AppVersion.vue_vue_type_script_setup_true_lang.oBVIPYf8.js";import{_ as s}from"./ActivityListItem.DER4T0LI.js";import{u as i,_ as a}from"./usePaged.CElQBFki.js";import{d as r,H as o,c as n,w as u,r as p,a as l,b as c,A as d,e as m,t as v,V as _,W as y,X as f,P as g}from"./index-a6TtsOgc.js";import{l as h}from"./activity-banner.C3kWKCRr.js";import{u as x}from"./useLocation.D1iCblDR.js";import"./wd-divider.BUjIEoaI.js";import"./PyText.vue_vue_type_script_setup_true_lang.C4vd1DLX.js";import"./wd-text.O2Z1f8vu.js";import"./Avatar.vue_vue_type_script_setup_true_lang.ex313Ryk.js";import"./PyTitle.CL2zNIOD.js";import"./index.CVFvtcrF.js";import"./_commonjsHelpers.lGe4XDVY.js";const j=r({__name:"index",setup(r){const j=o(),{update:w,longitude:b,latitude:P,hasFirstErrorToast:A,firstErrorToast:L}=x(),T=t=>({id:(null==t?void 0:t.id)||Date.now().toString(),img:null==t?void 0:t.picUrl,title:(null==t?void 0:t.name)||"未命名数根"}),S=t=>{const e=[];t.issueProduct&&(Array.isArray(t.issueProduct)?e.push(...t.issueProduct.map(t=>T(t))):e.push(T(t.issueProduct)));const s=[];var i;t.issueVoucher&&(Array.isArray(t.issueVoucher)?s.push(...t.issueVoucher.map(t=>T(t))):s.push({id:(null==(i=t.issueVoucher)?void 0:i.id)||Date.now().toString(),img:null==i?void 0:i.picUrl,title:(null==i?void 0:i.name)||"未命名权益"}));const a=[];return t.attendedUsers&&t.attendedUsers.forEach(t=>{a.push((t=>({avatar:null==t?void 0:t.avatar}))(t))}),{...t,pythrootList:e,profitList:s,participants:a}};const{list:V}=i(async function(t){const e="number"==typeof P.value?String(P.value):void 0,s="number"==typeof b.value?String(b.value):void 0;e&&s||A.value?await w({toast:!1,forceUpdate:"onPullDownRefresh"===(null==t?void 0:t.sourceType)}):(L(),await w({toast:!0}));const i=await g.app.getActivityPage({params:{type:1,myLocationLatitude:e,myLocationLongitude:s,...t}}),{code:a,data:r}=i||{};if(0!==a||!r)throw new Error("获取数据失败");let o=r.list||[];return o=o.map(t=>S(t)),{list:o,total:r.total||0}});return(i,r)=>{const o=a,g=m,x=s,w=e,b=t,P=p("layout-tabbar-uni");return l(),n(P,null,{default:u(()=>[c(b,{"custom-class":"pb-228rpx bg-#EFF2F5","banner-height":"364rpx","banner-src":d(h)},{default:u(()=>[c(g,{class:"p-30rpx gap-20rpx mt-[-278rpx] flex flex-col bg-transparent"},{default:u(()=>[0===d(V).length?(l(),n(g,{key:0,class:"mt-260rpx"},{default:u(()=>[c(o)]),_:1})):v("",!0),(l(!0),_(y,null,f(d(V),t=>(l(),n(x,{key:t.id,"attend-count":t.attendCount,"cover-img-src":t.picUrl||"",title:t.name,location:t.address||"","start-time":t.startTime,"end-time":t.endTime,participants:t.participants,"pythroot-list":t.pythrootList,"profit-list":t.profitList,distance:t.distance,"extra-button-text":"马上参与","time-status":t.timeStatus,onJoinNow:e=>{return s=t.id,void j.push({name:"activityDetail",params:{id:String(s)}});var s}},null,8,["attend-count","cover-img-src","title","location","start-time","end-time","participants","pythroot-list","profit-list","distance","time-status","onJoinNow"]))),128))]),_:1}),c(w)]),_:1},8,["banner-src"])]),_:1})}}});export{j as default};
