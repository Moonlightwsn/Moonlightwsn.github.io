import{d as e,C as a,D as s,q as t,c as l,a as i,J as o,B as n,w as c,z as d,v as m,y as r,A as u,bQ as v,aV as b,F as f}from"./index-BoOjZWLk.js";const p=e({name:"SmsCodeBtn",__name:"SmsCodeBtn",props:{isAdmin:{type:Boolean},mobile:{}},emits:["validate","register"],setup(e,{emit:p}){const g=e,y=p,{confirm:h,alert:C}=a(),w=s(0),S=s(!1),_=t(()=>S.value||w.value>0),B=/^\d{11}$/;let k;function x(){clearInterval(k),w.value=0}async function A(){if(!_.value)if(B.test(g.mobile))try{S.value=!0,g.isAdmin?await v.general.checkOutSendLoginSmsCode({data:{mobile:g.mobile,scene:21}}).catch(e=>{throw 1002000007===e.code&&C({title:"提示",msg:"用户还未注册，请联系管理员开通账户？"}),e}):await b.app.sendSmsCode({data:{mobile:g.mobile,scene:1}}).catch(e=>{throw 1004001001===e.code&&h({title:"提示",msg:"用户还未注册，是否前往注册？",success(){y("register")}}),e}),x(),w.value=60,k=setInterval(()=>{w.value-=1},996),f({icon:"success",title:"验证码已发送"})}catch(e){x(),console.log(e)}finally{S.value=!1}else y("validate")}return(e,a)=>{const s=r,t=o;return i(),l(t,{type:"text",disabled:n(_),onClick:A},{default:c(()=>[d(" 获取验证码 "),n(w)>0?(i(),l(s,{key:0},{default:c(()=>[d("("+u(n(w))+")",1)]),_:1})):m("",!0)]),_:1},8,["disabled"])}}});export{p as _};
