import{g as e,a3 as a,d as l,l as s,q as t,t as o,a$ as u,a4 as r,b0 as n,b1 as c,c as i,a as d,e as p,n as m,j as b,w as f,v as x,b as v,x as h,k as g,_,Y as y,H as V,u as k,b2 as $,b3 as w,D as S,b4 as C,r as B,B as q,b5 as z,I as U,J as j,z as A,F,aV as I,L as N,N as L}from"./index-BoOjZWLk.js";import{_ as R}from"./BannerView.vue_vue_type_script_setup_true_lang.CPKvwLYN.js";import{_ as T}from"./wd-form.DxSjOICQ.js";import{_ as W}from"./SmsCodeBtn.vue_vue_type_script_setup_true_lang.Dvr5lIS6.js";const D=Symbol("wd-checkbox-group"),J=_(l({name:"wd-checkbox",options:{addGlobalClass:!0,virtualHost:!0,styleIsolation:"shared"},props:{...e,customLabelClass:a(""),customShapeClass:a(""),modelValue:{type:[String,Number,Boolean],required:!0,default:!1},shape:{type:String},checkedColor:String,disabled:{type:[Boolean,null],default:null},trueValue:{type:[String,Number,Boolean],default:!0},falseValue:{type:[String,Number,Boolean],default:!1},size:String,maxWidth:String},emits:["change","update:modelValue"],setup(e,{expose:a,emit:l}){const _=e,y=l;a({toggle:F});const{parent:V,index:k}=s(D),$=t(()=>V?V.props.modelValue.indexOf(_.modelValue)>-1:_.modelValue===_.trueValue),w=t(()=>0===k.value),S=t(()=>{const e=o(V)?V.children:[];return k.value===e.length-1}),{proxy:C}=u();r(()=>_.modelValue,()=>{V&&V&&V.children&&V.children.forEach(e=>{e.$.uid!==C.$.uid&&e.modelValue===_.modelValue&&console.error(`The checkbox's bound value: ${_.modelValue} has been used`)})}),r(()=>_.shape,e=>{const a=["circle","square","button"];o(e)&&-1===a.indexOf(e)&&console.error(`shape must be one of ${a.toString()}`)});const B=t(()=>_.shape||n(V,"props.shape")||"circle"),q=t(()=>_.checkedColor||n(V,"props.checkedColor")),z=t(()=>{if(!V)return _.disabled;const{max:e,min:a,modelValue:l,disabled:s}=V.props;return!!(e&&l.length>=e&&!$.value||a&&l.length<=a&&$.value||!0===_.disabled||s&&null===_.disabled)||_.disabled}),U=t(()=>n(V,"props.inline")||!1),j=t(()=>n(V,"props.cell")||!1),A=t(()=>_.size||n(V,"props.size"));function F(){if(!z.value)if(V)y("change",{value:!$.value}),V.changeSelectState(_.modelValue);else{const e=_.modelValue===_.trueValue?_.falseValue:_.trueValue;y("update:modelValue",e),y("change",{value:e})}}return c(()=>{null===_.modelValue&&console.error("checkbox's value must be set")}),(e,a)=>{const l=p;return d(),i(l,{class:b(`wd-checkbox ${j.value?"is-cell-box":""} ${"button"===B.value?"is-button-box":""} ${$.value?"is-checked":""} ${w.value?"is-first-child":""} ${S.value?"is-last-child":""} ${U.value?"is-inline":""} ${"button"===B.value?"is-button":""} ${z.value?"is-disabled":""} ${A.value?"is-"+A.value:""} ${e.customClass}`),style:m(e.customStyle),onClick:F},{default:f(()=>["button"!==B.value?(d(),i(l,{key:0,class:b(`wd-checkbox__shape ${"square"===B.value?"is-square":""} ${e.customShapeClass}`),style:m($.value&&!z.value&&q.value?"color :"+q.value:"")},{default:f(()=>[v(h,{"custom-class":"wd-checkbox__check",name:"check-bold"})]),_:1},8,["class","style"])):x("",!0),v(l,{class:b(`wd-checkbox__label ${e.customLabelClass}`),style:m($.value&&"button"===B.value&&!z.value&&q.value?"color:"+q.value:"")},{default:f(()=>["button"===B.value&&$.value?(d(),i(h,{key:0,"custom-class":"wd-checkbox__btn-check",name:"check-bold"})):x("",!0),v(l,{class:"wd-checkbox__txt",style:m(e.maxWidth?"max-width:"+e.maxWidth:"")},{default:f(()=>[g(e.$slots,"default",{},void 0,!0)]),_:3},8,["style"])]),_:3},8,["class","style"])]),_:3},8,["class","style"])}}}),[["__scopeId","data-v-92af0321"]]),O=_(l({__name:"index",setup(e){const a=y(),l=V(),s=k(),o=$(),u=w(),r=S(),n=C({agree:!1,code:"",mobile:""}),c=S(!1);async function m(){return await r.value.validate()}async function b(){var e;if(c.value)return;const{valid:t}=await m();if(t)if(n.agree)try{c.value=!0;const t=await I.app.smsLogin({data:{...n}}),{accessToken:r}=(null==t?void 0:t.data)||{};r?(a.value=r,u.updateUserVerifyStatus(null==(e=null==t?void 0:t.data)?void 0:e.verifyStatus),o.triggerSuccess(),F({icon:"success",title:"登录成功",success(){setTimeout(()=>{s.order()||l.replaceAll({name:"index"})},1e3)}})):F({icon:"error",title:(null==t?void 0:t.msg)||"登录失败"})}finally{c.value=!1}else F({icon:"error",title:"请阅读并同意用户协议"})}const h=/^\d{11}$/;function g(e){return!(n.mobile&&h.test(n.mobile)&&!e)}const _=S(!1);async function D(){var e,a;if(!_.value)try{N({title:"加载中"}),_.value=!0;const l=await I.app.caRegisterSign();if(0===l.code&&l.data){const{baseUrl:s,path:t,clientId:o,timestamp:u,signature:r,redirectUri:n,appBizNo:c}=l.data,i=(e=`${s}${t}`,a={client_env:"h5",client_id:o,timestamp:u,signature:r,redirect_uri:n,app_biz_no:c},`${e}?${new URLSearchParams({...a,timestamp:a.timestamp.toString()}).toString()}`);window.location.href=i}}finally{L(),_.value=!1}}function O(e){l.push({name:"agreement",params:{type:e}})}const P=t(()=>1===Number("0"));return(e,a)=>{const l=z,s=J,t=U,o=p,u=j,y=T,V=R,k=B("layout-default-uni");return d(),i(k,null,{default:f(()=>[v(V,{fixed:!1,"custom-class":"bg-white login-page","banner-src":q("/assets/login-bg-BD7CSFAJ.png"),"banner-height":"332rpx"},{default:f(()=>[v(o,{class:"py-60rpx px-56rpx flex h-full flex-grow flex-col"},{default:f(()=>[v(y,{ref_key:"form",ref:r,"custom-class":"gap-16rpx flex flex-col",model:q(n)},{default:f(()=>[v(l,{modelValue:q(n).mobile,"onUpdate:modelValue":a[0]||(a[0]=e=>q(n).mobile=e),prop:"mobile",rules:[{required:!0,message:"请输入手机号"},{required:!1,pattern:h,message:"手机号格式不正确"}],"custom-class":"rounded-10rpx px-28rpx","no-border":"",type:"digit","input-mode":"numeric",placeholder:"请输入手机号"},null,8,["modelValue","rules"]),v(l,{modelValue:q(n).code,"onUpdate:modelValue":a[1]||(a[1]=e=>q(n).code=e),prop:"code",rules:[{required:!1,validator:g,message:"请输入验证码"}],"custom-class":"rounded-10rpx px-28rpx","no-border":"",type:"text","input-mode":"text",placeholder:"请输入验证码"},{suffix:f(()=>[v(W,{mobile:q(n).mobile,"is-admin":!1,onValidate:m,onRegister:D},null,8,["mobile"])]),_:1},8,["modelValue","rules"]),v(o,{class:"mt-100rpx flex items-start"},{default:f(()=>[v(s,{modelValue:q(n).agree,"onUpdate:modelValue":a[2]||(a[2]=e=>q(n).agree=e),shape:"square","custom-class":"mt-12rpx"},null,8,["modelValue"]),v(o,{class:""},{default:f(()=>[v(t,{text:"我已阅读并同意"}),v(t,{text:"《用户协议》",color:"#29A2FB",onClick:a[3]||(a[3]=e=>O("user"))}),v(t,{text:"《隐私协议》",color:"#29A2FB",onClick:a[4]||(a[4]=e=>O("privacy"))}),v(t,{text:"《授权协议》",color:"#29A2FB",onClick:a[5]||(a[5]=e=>O("grant"))})]),_:1})]),_:1}),v(u,{type:"primary",block:"",size:"large",round:!1,disabled:c.value,onClick:b},{default:f(()=>[A(" 登录 ")]),_:1},8,["disabled"]),q(P)?(d(),i(o,{key:0,class:"mt-50rpx flex justify-center"},{default:f(()=>[v(t,{text:"还没有账号？"}),v(t,{text:"立即注册",color:_.value?"#666":"#29A2FB",onClick:D},null,8,["color"])]),_:1})):x("",!0)]),_:1},8,["model"]),v(o,{class:"flex-grow"}),v(o,{class:"flex flex-col items-center"},{default:f(()=>[v(t,{text:"浦江数链提供技术支持",color:"#999",size:"24rpx"}),v(t,{text:"沪ICP备2023032312号-2",color:"#999",size:"24rpx"})]),_:1})]),_:1})]),_:1},8,["banner-src"])]),_:1})}}}),[["__scopeId","data-v-91dabee5"]]);export{O as default};
