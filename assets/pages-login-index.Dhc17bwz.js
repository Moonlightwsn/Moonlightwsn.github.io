import{g as e,$ as a,d as l,k as s,p as t,s as o,aU as u,a0 as r,aV as n,aW as c,c as i,a as d,e as p,n as m,h as f,w as b,t as x,b as v,v as h,j as g,_,U as y,H as V,aX as k,aY as $,aZ as S,C as w,a_ as C,r as B,A as U,a$ as q,E as z,F as A,y as j,D as F,aO as I,I as N,J as L}from"./index-DLEqDFWl.js";import{_ as T}from"./BannerView.vue_vue_type_script_setup_true_lang.C9IVHeQj.js";import{_ as W}from"./wd-form.BZQGzXkU.js";import{_ as O}from"./SmsCodeBtn.vue_vue_type_script_setup_true_lang.DUevzLbQ.js";const R=Symbol("wd-checkbox-group"),D=_(l({name:"wd-checkbox",options:{addGlobalClass:!0,virtualHost:!0,styleIsolation:"shared"},props:{...e,customLabelClass:a(""),customShapeClass:a(""),modelValue:{type:[String,Number,Boolean],required:!0,default:!1},shape:{type:String},checkedColor:String,disabled:{type:[Boolean,null],default:null},trueValue:{type:[String,Number,Boolean],default:!0},falseValue:{type:[String,Number,Boolean],default:!1},size:String,maxWidth:String},emits:["change","update:modelValue"],setup(e,{expose:a,emit:l}){const _=e,y=l;a({toggle:F});const{parent:V,index:k}=s(R),$=t(()=>V?V.props.modelValue.indexOf(_.modelValue)>-1:_.modelValue===_.trueValue),S=t(()=>0===k.value),w=t(()=>{const e=o(V)?V.children:[];return k.value===e.length-1}),{proxy:C}=u();r(()=>_.modelValue,()=>{V&&V&&V.children&&V.children.forEach(e=>{e.$.uid!==C.$.uid&&e.modelValue===_.modelValue&&console.error(`The checkbox's bound value: ${_.modelValue} has been used`)})}),r(()=>_.shape,e=>{const a=["circle","square","button"];o(e)&&-1===a.indexOf(e)&&console.error(`shape must be one of ${a.toString()}`)});const B=t(()=>_.shape||n(V,"props.shape")||"circle"),U=t(()=>_.checkedColor||n(V,"props.checkedColor")),q=t(()=>{if(!V)return _.disabled;const{max:e,min:a,modelValue:l,disabled:s}=V.props;return!!(e&&l.length>=e&&!$.value||a&&l.length<=a&&$.value||!0===_.disabled||s&&null===_.disabled)||_.disabled}),z=t(()=>n(V,"props.inline")||!1),A=t(()=>n(V,"props.cell")||!1),j=t(()=>_.size||n(V,"props.size"));function F(){if(!q.value)if(V)y("change",{value:!$.value}),V.changeSelectState(_.modelValue);else{const e=_.modelValue===_.trueValue?_.falseValue:_.trueValue;y("update:modelValue",e),y("change",{value:e})}}return c(()=>{null===_.modelValue&&console.error("checkbox's value must be set")}),(e,a)=>{const l=p;return d(),i(l,{class:f(`wd-checkbox ${A.value?"is-cell-box":""} ${"button"===B.value?"is-button-box":""} ${$.value?"is-checked":""} ${S.value?"is-first-child":""} ${w.value?"is-last-child":""} ${z.value?"is-inline":""} ${"button"===B.value?"is-button":""} ${q.value?"is-disabled":""} ${j.value?"is-"+j.value:""} ${e.customClass}`),style:m(e.customStyle),onClick:F},{default:b(()=>["button"!==B.value?(d(),i(l,{key:0,class:f(`wd-checkbox__shape ${"square"===B.value?"is-square":""} ${e.customShapeClass}`),style:m($.value&&!q.value&&U.value?"color :"+U.value:"")},{default:b(()=>[v(h,{"custom-class":"wd-checkbox__check",name:"check-bold"})]),_:1},8,["class","style"])):x("",!0),v(l,{class:f(`wd-checkbox__label ${e.customLabelClass}`),style:m($.value&&"button"===B.value&&!q.value&&U.value?"color:"+U.value:"")},{default:b(()=>["button"===B.value&&$.value?(d(),i(h,{key:0,"custom-class":"wd-checkbox__btn-check",name:"check-bold"})):x("",!0),v(l,{class:"wd-checkbox__txt",style:m(e.maxWidth?"max-width:"+e.maxWidth:"")},{default:b(()=>[g(e.$slots,"default",{},void 0,!0)]),_:3},8,["style"])]),_:3},8,["class","style"])]),_:3},8,["class","style"])}}}),[["__scopeId","data-v-92af0321"]]),E=_(l({__name:"index",setup(e){const a=y(),l=V(),s=k(),o=$(),u=S(),r=w(),n=C({agree:!1,code:"",mobile:""}),c=w(!1);async function m(){return await r.value.validate()}async function f(){var e;if(c.value)return;const{valid:t}=await m();if(t)if(n.agree)try{c.value=!0;const t=await I.app.smsLogin({data:{...n}}),{accessToken:r}=(null==t?void 0:t.data)||{};r?(a.value=r,u.updateUserVerifyStatus(null==(e=null==t?void 0:t.data)?void 0:e.verifyStatus),o.triggerSuccess(),F({icon:"success",title:"登录成功",success(){setTimeout(()=>{s.order()||l.replaceAll({name:"index"})},1e3)}})):F({icon:"error",title:(null==t?void 0:t.msg)||"登录失败"})}finally{c.value=!1}else F({icon:"error",title:"请阅读并同意用户协议"})}const h=/^\d{11}$/;function g(e){return!(n.mobile&&h.test(n.mobile)&&!e)}const _=w(!1);async function R(){var e,a;if(!_.value)try{N({title:"加载中"}),_.value=!0;const l=await I.app.caRegisterSign();if(0===l.code&&l.data){const{baseUrl:s,path:t,clientId:o,timestamp:u,signature:r,redirectUri:n,appBizNo:c}=l.data,i=(e=`${s}${t}`,a={client_env:"h5",client_id:o,timestamp:u,signature:r,redirect_uri:n,app_biz_no:c},`${e}?${new URLSearchParams({...a,timestamp:a.timestamp.toString()}).toString()}`);window.location.href=i}}finally{L(),_.value=!1}}function E(e){l.push({name:"agreement",params:{type:e}})}const J=t(()=>1===Number("0"));return(e,a)=>{const l=q,s=D,t=z,o=p,u=A,y=W,V=T,k=B("layout-default-uni");return d(),i(k,null,{default:b(()=>[v(V,{fixed:!1,"custom-class":"bg-white login-page","banner-src":U("/assets/login-bg-BD7CSFAJ.png"),"banner-height":"332rpx"},{default:b(()=>[v(o,{class:"py-60rpx px-56rpx flex h-full flex-grow flex-col"},{default:b(()=>[v(y,{ref_key:"form",ref:r,"custom-class":"gap-16rpx flex flex-col",model:U(n)},{default:b(()=>[v(l,{modelValue:U(n).mobile,"onUpdate:modelValue":a[0]||(a[0]=e=>U(n).mobile=e),prop:"mobile",rules:[{required:!0,message:"请输入手机号"},{required:!1,pattern:h,message:"手机号格式不正确"}],"custom-class":"rounded-10rpx px-28rpx","no-border":"",type:"digit","input-mode":"numeric",placeholder:"请输入手机号"},null,8,["modelValue","rules"]),v(l,{modelValue:U(n).code,"onUpdate:modelValue":a[1]||(a[1]=e=>U(n).code=e),prop:"code",rules:[{required:!1,validator:g,message:"请输入验证码"}],"custom-class":"rounded-10rpx px-28rpx","no-border":"",type:"text","input-mode":"text",placeholder:"请输入验证码"},{suffix:b(()=>[v(O,{mobile:U(n).mobile,"is-admin":!1,onValidate:m,onRegister:R},null,8,["mobile"])]),_:1},8,["modelValue","rules"]),v(o,{class:"mt-100rpx flex items-start"},{default:b(()=>[v(s,{modelValue:U(n).agree,"onUpdate:modelValue":a[2]||(a[2]=e=>U(n).agree=e),shape:"square","custom-class":"mt-12rpx"},null,8,["modelValue"]),v(o,{class:""},{default:b(()=>[v(t,{text:"我已阅读并同意"}),v(t,{text:"《用户协议》",color:"#29A2FB",onClick:a[3]||(a[3]=e=>E("user"))}),v(t,{text:"《隐私协议》",color:"#29A2FB",onClick:a[4]||(a[4]=e=>E("privacy"))}),v(t,{text:"《授权协议》",color:"#29A2FB",onClick:a[5]||(a[5]=e=>E("grant"))})]),_:1})]),_:1}),v(u,{type:"primary",block:"",size:"large",round:!1,disabled:c.value,onClick:f},{default:b(()=>[j(" 登录 ")]),_:1},8,["disabled"]),U(J)?(d(),i(o,{key:0,class:"mt-50rpx flex justify-center"},{default:b(()=>[v(t,{text:"还没有账号？"}),v(t,{text:"立即注册",color:_.value?"#666":"#29A2FB",onClick:R},null,8,["color"])]),_:1})):x("",!0)]),_:1},8,["model"]),v(o,{class:"flex-grow"}),v(o,{class:"flex flex-col items-center"},{default:b(()=>[v(t,{text:"浦江数链提供技术支持",color:"#999",size:"24rpx"}),v(t,{text:"沪ICP备2023032312号-2",color:"#999",size:"24rpx"})]),_:1})]),_:1})]),_:1},8,["banner-src"])]),_:1})}}}),[["__scopeId","data-v-91dabee5"]]);export{E as default};
