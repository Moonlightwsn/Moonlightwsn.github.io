import{_ as t}from"./BannerView.vue_vue_type_script_setup_true_lang.CrW26RPs.js";import{_ as i,a}from"./activity-cover.IIsedPYs.js";import{u as s,_ as e}from"./usePaged.CYRsi8lB.js";import{d as r,H as o,c as n,w as u,r as p,a as l,b as c,A as d,e as m,t as v,K as y,L as f,M as g,P as _}from"./index-DbmF-9aG.js";import{l as h}from"./activity-banner.C3kWKCRr.js";import{u as x}from"./useLocation.C9mtZ1-B.js";import"./wd-card.CPkgHGk0.js";import"./wd-divider.DQmw5Zxo.js";import"./PyText.vue_vue_type_script_setup_true_lang.B4U5MSzJ.js";import"./wd-text.Qyj5H_OV.js";import"./PyTitle.Cj1MO8gs.js";import"./index.3w_ZffHZ.js";const w=r({__name:"index",setup(r){const w=o(),{update:b,longitude:j,latitude:L}=x(),P=t=>({id:(null==t?void 0:t.id)||Date.now().toString(),img:null==t?void 0:t.picUrl,title:(null==t?void 0:t.name)||"未命名数根"}),A=t=>{const i=[];t.issueProduct&&(Array.isArray(t.issueProduct)?i.push(...t.issueProduct.map(t=>P(t))):i.push(P(t.issueProduct)));const a=[];var s;t.issueVoucher&&(Array.isArray(t.issueVoucher)?a.push(...t.issueVoucher.map(t=>P(t))):a.push({id:(null==(s=t.issueVoucher)?void 0:s.id)||Date.now().toString(),img:null==s?void 0:s.picUrl,title:(null==s?void 0:s.name)||"未命名权益"}));const e=[];return t.attendedUsers&&t.attendedUsers.forEach(t=>{e.push((t=>({avatar:null==t?void 0:t.avatar}))(t))}),{...t,pythrootList:i,profitList:a,participants:e}};const{list:S}=s(async function(t){const i="number"==typeof L.value?String(L.value):void 0,a="number"==typeof j.value?String(j.value):void 0;i&&a?b(!1):await b(!0);const s=await _.app.getActivityPage({params:{type:1,myLocationLatitude:i,myLocationLongitude:a,...t}}),{code:e,data:r}=s||{};if(0!==e||!r)throw new Error("获取数据失败");let o=r.list||[];return o=o.map(t=>A(t)),{list:o,total:r.total||0}});return(s,r)=>{const o=e,_=m,x=i,b=t,j=p("layout-tabbar-uni");return l(),n(j,null,{default:u(()=>[c(b,{"custom-class":"pb-228rpx bg-#EFF2F5","banner-height":"364rpx","banner-src":d(h)},{default:u(()=>[c(_,{class:"p-30rpx gap-20rpx mt-[-278rpx] flex flex-col bg-transparent"},{default:u(()=>[0===d(S).length?(l(),n(_,{key:0,class:"mt-260rpx"},{default:u(()=>[c(o)]),_:1})):v("",!0),(l(!0),y(f,null,g(d(S),t=>(l(),n(x,{key:t.id,"cover-img-src":t.picUrl||d(a),title:t.name,location:t.address||"","start-time":t.createTime,"end-time":t.endTime,participants:t.participants,"pythroot-list":t.pythrootList,"profit-list":t.profitList,distance:t.distance,"extra-button-text":"马上参与","time-status":t.timeStatus,onJoinNow:i=>{return a=t.id,void w.push({name:"activityDetail",params:{id:String(a)}});var a}},null,8,["cover-img-src","title","location","start-time","end-time","participants","pythroot-list","profit-list","distance","time-status","onJoinNow"]))),128))]),_:1})]),_:1},8,["banner-src"])]),_:1})}}});export{w as default};
