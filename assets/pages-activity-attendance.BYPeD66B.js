import{m as e,f as t,g as a,d as s,h as l,c as i,a as n,e as r,n as o,j as u,w as c,k as d,_ as p,l as f,p as v,q as _,s as m,t as x,v as y,b as g,x as w,y as h,z as b,A as $,B as k,H as j,C as S,D as C,r as I,F as B,P as N,G as D,I as z,J as T,K as A,L as U,M as F,N as L}from"./index-B1Tc0IQL.js";import{_ as Y}from"./BannerView.vue_vue_type_script_setup_true_lang.C5Yo6SAN.js";import{_ as G,a as M}from"./wd-tab.Dh0VLc6b.js";import{_ as P}from"./Descriptions.vue_vue_type_script_setup_true_lang.DKwGw48W.js";import{_ as R}from"./PyTitle.ByCrNrVh.js";import{u as H}from"./useRouteState.BAh4bdkm.js";import{u as q}from"./usePageOptions._dtdj5tQ.js";import{u as J}from"./useLocation.Dnyet2w1.js";import"./wd-col.DKFPPePC.js";const K={...a,active:t(0),vertical:e(!1),dot:e(!1),space:String,alignCenter:e(!1)},O=Symbol("wd-steps"),V=p(s({name:"wd-steps",options:{addGlobalClass:!0,virtualHost:!0,styleIsolation:"shared"},props:K,setup(e){const t=e,{linkChildren:a}=l(O);return a({props:t}),(e,t)=>{const a=r;return n(),i(a,{class:u(`wd-steps ${e.customClass} ${e.vertical?"is-vertical":""}`),style:o(e.customStyle)},{default:c(()=>[d(e.$slots,"default",{},void 0,!0)]),_:3},8,["class","style"])}}}),[["__scopeId","data-v-fdf5188c"]]),E=p(s({name:"wd-step",options:{addGlobalClass:!0,virtualHost:!0,styleIsolation:"shared"},props:{...a,title:String,description:String,icon:String,status:String},setup(e){const t=e,{parent:a,index:s}=f(O),{translate:l}=v("steps"),p=_(()=>function(e){if(t.status)return t.status;if(a){const{active:t}=a.props;return Number(t)>e?"finished":Number(t)===e?"process":"wait"}return"wait"}(s.value)),j=_(()=>function(e){if(t.title)return t.title;switch(e){case"finished":return l("finished");case"error":return l("failed");case"process":return l("process");default:return l("wait")}}(p.value)),S=_(()=>{const e={};if(a){const{vertical:t,space:s}=a.props;t?x(s)&&(e.height=s):e.width=s||100/a.children.length+"%"}return`${m(e)}${t.customStyle}`}),C=_(()=>{if(x(a)){const{vertical:e,alignCenter:t}=a.props;return Boolean(!e&&t)}return!1}),I=_(()=>!!x(a)&&Boolean(a.props.vertical)),B=_(()=>!!x(a)&&Boolean(a.props.dot)),N=_(()=>x(a)?Number(a.children.length):0);return(e,t)=>{const a=r,l=h;return p.value?(n(),i(a,{key:0,class:u(`wd-step ${e.customClass} ${p.value?"is-"+p.value:""} ${C.value?"is-center":""}  ${I.value?"is-vertical":""}`),style:o(S.value)},{default:c(()=>[g(a,{class:u("wd-step__header  "+(B.value?"is-dot":""))},{default:c(()=>[g(a,{class:u("wd-step__icon  "+(B.value?"is-dot":e.icon||e.$slots.icon?"is-icon":"is-text"))},{default:c(()=>[B.value?(n(),i(a,{key:0,class:"wd-step__dot"})):e.$slots.icon?d(e.$slots,"icon",{key:1},void 0,!0):e.icon?(n(),i(w,{key:2,"custom-class":"wd-step__icon-inner",name:e.icon},null,8,["name"])):(n(),i(a,{key:3,class:"wd-step__icon-outer"},{default:c(()=>["finished"===p.value?(n(),i(w,{key:0,name:"check-bold"})):"error"===p.value?(n(),i(w,{key:1,name:"close-bold"})):(n(),i(l,{key:2},{default:c(()=>[b($(k(s)+1),1)]),_:1}))]),_:1}))]),_:3},8,["class"]),k(s)<N.value-1?(n(),i(a,{key:0,class:"wd-step__line"})):y("",!0)]),_:3},8,["class"]),g(a,{class:"wd-step__content"},{default:c(()=>[g(a,{class:u("wd-step__title "+(e.$slots.description||e.description?"is-description":""))},{default:c(()=>[e.$slots.title?d(e.$slots,"title",{key:0},void 0,!0):(n(),i(l,{key:1},{default:c(()=>[b($(j.value),1)]),_:1}))]),_:3},8,["class"]),e.$slots.description||e.description?(n(),i(a,{key:0,class:"wd-step__description"},{default:c(()=>[e.$slots.description?d(e.$slots,"description",{key:0},void 0,!0):(n(),i(l,{key:1},{default:c(()=>[b($(e.description),1)]),_:1}))]),_:3})):y("",!0)]),_:3})]),_:3},8,["class","style"])):y("",!0)}}}),[["__scopeId","data-v-b36f9026"]]),Q="YYYY年MM月DD日",W=p(s({__name:"attendance",setup(e){const t=j(),a=H(),{confirm:s}=S(),l=C(null),o=C("");q(async e=>{if(null==e?void 0:e.id)try{const{id:t}=e,a=Number.parseInt(t,10);if(Number.isNaN(a))return void B({icon:"error",title:"无效的活动ID"});const s=await N.app.getActivity({params:{id:a}});(null==s?void 0:s.data)?(l.value=s.data,o.value=`${D(l.value.startTime,Q)} - ${D(l.value.endTime,Q)}`):(l.value=null,B({title:"没有获取到权益详情"}))}catch(t){console.error("获取活动详情失败:",t),B({icon:"error",title:"获取活动详情失败，请稍后重试"})}});const{latitude:u,longitude:d,loading:p,update:f}=J(),v=_(()=>p.value?"正在获取定位...":"number"==typeof u.value&&"number"==typeof d.value?`纬度：${u.value.toFixed(6)}, 经度：${d.value.toFixed(6)}`:"请获取位置信息"),m=(e=!1,t)=>f({toast:e,forceUpdate:t}),x=async()=>{var e;const i=null==(e=null==l?void 0:l.value)?void 0:e.id;if(!i)return void B({icon:"error",title:"获取活动信息失败"});if(await m(!0,!0),null===u.value||null===d.value)return void setTimeout(()=>{B({icon:"error",title:"成功获取位置信息后才可以线上签到"})},2e3);U({title:"签到提交中..."});const n=await N.app.createActivityAttendance({data:{channel:F()?"weapp":"h5",activityId:i,locationLatitude:u.value.toString(),locationLongitude:d.value.toString()}}).catch(e=>{1008005009===(null==e?void 0:e.code)&&s({title:"数字身份保护说明",msg:"你的账号里数字资产（数根、权益）已经超出安全范围啦。为了保护好这些资产，需要先领取实名数字身份，之后就能顺利参加活动、获取新的数根和权益啦～",cancelButtonText:"放弃",confirmButtonText:"领取数字身份",success(){t.push({name:"digitalIdCard"})}})}).finally(()=>{L()});0===(null==n?void 0:n.code)&&(null==n?void 0:n.data)&&(B({icon:"success",title:"提交签到成功"}),function(e,s){const l=a.depositRouteState(s);t.replace({name:"activityResult",params:{id:String(e),pageUUID:l}})}(i,n.data))};return(e,t)=>{const a=A,s=R,u=r,d=w,p=z,f=P,_=M,j=G,S=E,C=V,B=h,N=T,D=Y,U=I("layout-default-uni");return n(),i(U,null,{default:c(()=>[g(D,{"custom-class":"pb-154rpx"},{header:c(()=>{var e;return[(null==(e=l.value)?void 0:e.picUrl)?(n(),i(a,{key:0,src:l.value.picUrl,width:"100%",height:"364rpx",mode:"aspectFill"},null,8,["src"])):y("",!0)]}),default:c(()=>[g(u,{class:"pt-10rpx px-30rpx h-full w-full bg-white"},{default:c(()=>[g(u,{class:"activity-info"},{default:c(()=>{var e;return[g(u,{class:"mb-16rpx gap-20rpx flex items-center justify-between"},{default:c(()=>{var e;return[g(s,{text:(null==(e=l.value)?void 0:e.name)||""},null,8,["text"]),g(u,{class:"px-16rpx py-8rpx text-28rpx rounded-full bg-blue-50 text-blue-400"},{default:c(()=>[b(" 进行中 ")]),_:1})]}),_:1}),g(f,{data:[{label:"活动地址：",icon:"location",value:null==(e=l.value)?void 0:e.address},{label:"活动时间：",icon:"time",value:o.value}],"label-span":10,"value-span":14},{label:c(({item:e})=>[g(u,{class:"gap-20rpx inline-flex items-center"},{default:c(()=>[g(u,{class:"w-36rpx h-36rpx inline-flex items-center justify-center"},{default:c(()=>[g(d,{name:e.icon,size:"location"===e.icon?"36rpx":"28rpx"},null,8,["name","size"])]),_:2},1024),g(p,{text:e.label},null,8,["text"])]),_:2},1024)]),_:1},8,["data"]),g(u,{class:"sign-step mt-60rpx"},{default:c(()=>[g(u,{class:"inline-flex"},{default:c(()=>[g(j,{type:"long"},{default:c(()=>[g(_,{title:"签到步骤"})]),_:1})]),_:1}),g(C,{class:"mt-40rpx",active:2,vertical:"",dot:""},{default:c(()=>[g(S,{title:"获取当前位置"}),g(S,{title:"提交签到"})]),_:1})]),_:1}),g(u,{class:"current-location"},{default:c(()=>[g(u,{class:"inline-flex"},{default:c(()=>[g(j,{type:"long"},{default:c(()=>[g(_,{title:"当前位置"})]),_:1})]),_:1}),g(u,{class:"location-card mt-40rpx py-30rpx px-20rpx flex items-center justify-between rounded-lg bg-gray-100"},{default:c(()=>[g(u,null,{default:c(()=>[g(u,{class:"gap-300rpx flex items-center"},{default:c(()=>[g(u,null,{default:c(()=>[g(d,{name:"location",size:"20",color:"#60a5fa "}),g(B,{class:"ml-2 font-medium"},{default:c(()=>[b("位置：")]),_:1})]),_:1}),g(N,{type:"text",class:"text-blue-400",onClick:t[0]||(t[0]=e=>m(!1,!0))},{default:c(()=>[g(d,{name:"refresh1"}),g(B,{class:"ml-1"},{default:c(()=>[b("重新获取")]),_:1})]),_:1})]),_:1}),g(B,{class:"text-gray-500"},{default:c(()=>[b($(k(v)),1)]),_:1})]),_:1})]),_:1})]),_:1})]}),_:1})]),_:1}),g(u,{class:"py-36rpx px-54rpx z-999 fixed bottom-0 left-0 right-0 bg-white"},{default:c(()=>[g(N,{class:"w-full",onClick:x},{default:c(()=>[b(" 提交签到 ")]),_:1})]),_:1})]),_:1})]),_:1})}}}),[["__scopeId","data-v-316a9ad4"]]);export{W as default};
