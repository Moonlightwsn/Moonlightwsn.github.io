import{a4 as t,a5 as a,p as e,F as s,C as i,G as o}from"./index-a6TtsOgc.js";const r=t("location",{state:()=>({loading:!1,hasFirstErrorToast:!1,longitude:null,latitude:null,lastUpdateTimestamp:0}),actions:{async updateCurrentLocation({forceUpdate:t=!1}={}){if(this.latitude&&this.longitude){const a=Date.now();if(!t&&a-this.lastUpdateTimestamp<=6e4)return{latitude:this.latitude,longitude:this.longitude}}return new Promise((t,e)=>{this.loading=!0,a({type:"wgs84",success:a=>{if(a){const{latitude:e,longitude:s}=a;this.latitude=e,this.longitude=s,this.lastUpdateTimestamp=Date.now(),t(a)}else t(void 0)},fail:t=>{e(t)},complete:()=>{this.loading=!1}}),setTimeout(()=>{e(new Error("获取定位超时"))},1e4)})},setHasErrorToastFlag(){this.hasFirstErrorToast=!0}}});function n(){const t=r();return{loading:e(()=>t.loading),hasFirstErrorToast:e(()=>t.hasFirstErrorToast),latitude:e(()=>t.latitude),longitude:e(()=>t.longitude),update:function({toast:a=!1,forceUpdate:e=!1}={}){return a&&s({title:"正在获取定位..."}),t.updateCurrentLocation({forceUpdate:e}).catch(t=>{console.log(t),a&&i({icon:"error",title:t.message||"无法获取定位"})}).finally(()=>{a&&o()})},firstErrorToast:function(){t.setHasErrorToastFlag()}}}export{n as u};
